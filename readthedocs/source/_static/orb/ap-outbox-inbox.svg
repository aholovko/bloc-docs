<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1045px" preserveAspectRatio="none" style="width:916px;height:1045px;" version="1.1" viewBox="0 0 916 1045" width="916px" zoomAndPan="magnify"><defs><style type="text/css"><![CDATA[*.s_181818_e7e7e7 {stroke:#181818;}*.f_000000_ffffff {fill:#000000;}*.f_dddddd_222222 {fill:#dddddd;}*.f_ffffff_000000 {fill:#ffffff;}*.s_000000_ffffff {stroke:#000000;}*.f_181818_e7e7e7 {fill:#181818;}*.f_eeeeee_555555 {fill:#eeeeee;}*.f_feffdd_333333 {fill:#feffdd;}@media (prefers-color-scheme:dark) {*.s_181818_e7e7e7 {stroke:#e7e7e7;}*.f_000000_ffffff {fill:#ffffff;}*.f_dddddd_222222 {fill:#222222;}*.f_ffffff_000000 {fill:#000000;}*.s_000000_ffffff {stroke:#ffffff;}*.f_181818_e7e7e7 {fill:#e7e7e7;}*.f_eeeeee_555555 {fill:#555555;}*.f_feffdd_333333 {fill:#333333;}}]]></style></defs><g><rect class="s_181818_e7e7e7" fill="#FFFFFF" height="1033.8438" style="stroke-width:0.5;" width="415.5" x="146.5" y="6"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="66" x="318.75" y="18.0669">Domain1</text><rect class="f_dddddd_222222 s_181818_e7e7e7" height="1033.8438" style="stroke-width:0.5;" width="346.5" x="564" y="6"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="68" x="703.25" y="18.0669">DomainN</text><rect class="f_ffffff_000000 s_181818_e7e7e7" height="183.7969" style="stroke-width:1.0;" width="10" x="179" y="118.5625"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="390.4258" style="stroke-width:1.0;" width="10" x="179" y="349.1914"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="120.9648" style="stroke-width:1.0;" width="10" x="430" y="258.2266"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="29.1328" style="stroke-width:1.0;" width="10" x="526" y="434.0234"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="248.3281" style="stroke-width:1.0;" width="10" x="590" y="549.5547"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="124.5313" style="stroke-width:1.0;" width="10" x="590" y="827.0156"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="173.7969" style="stroke-width:1.0;" width="10" x="849" y="768.75"/><rect class="s_000000_ffffff" height="75.3984" style="stroke-width:1.5;fill:none;" width="363.5" x="140.5" y="219.9609"/><line class="s_181818_e7e7e7" style="stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="80" x2="80" y1="87.4297" y2="960.5469"/><line class="s_181818_e7e7e7" style="stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="183.5" x2="183.5" y1="87.4297" y2="960.5469"/><line class="s_181818_e7e7e7" style="stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="326" x2="326" y1="87.4297" y2="960.5469"/><line class="s_181818_e7e7e7" style="stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="435" x2="435" y1="87.4297" y2="960.5469"/><line class="s_181818_e7e7e7" style="stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="531" x2="531" y1="87.4297" y2="960.5469"/><line class="s_181818_e7e7e7" style="stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="595" x2="595" y1="87.4297" y2="960.5469"/><line class="s_181818_e7e7e7" style="stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="757.5" x2="757.5" y1="87.4297" y2="960.5469"/><line class="s_181818_e7e7e7" style="stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="853.5" x2="853.5" y1="87.4297" y2="960.5469"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="110" x="22" y="84.1279">Domain1Admin</text><ellipse class="s_181818_e7e7e7" cx="80" cy="19.6328" fill="#E2E2F0" rx="8" ry="8" style="stroke-width:0.5;"/><path class="s_181818_e7e7e7" d="M80,27.6328 L80,54.6328 M67,35.6328 L93,35.6328 M80,54.6328 L67,69.6328 M80,54.6328 L93,69.6328 " fill="none" style="stroke-width:0.5;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="110" x="22" y="972.542">Domain1Admin</text><ellipse class="s_181818_e7e7e7" cx="80" cy="984.3438" fill="#E2E2F0" rx="8" ry="8" style="stroke-width:0.5;"/><path class="s_181818_e7e7e7" d="M80,992.3438 L80,1019.3438 M67,1000.3438 L93,1000.3438 M80,1019.3438 L67,1034.3438 M80,1019.3438 L93,1034.3438 " fill="none" style="stroke-width:0.5;"/><rect class="s_181818_e7e7e7" fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke-width:0.5;" width="67" x="150.5" y="56.1328"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53" x="157.5" y="76.1279">Outbox</text><rect class="s_181818_e7e7e7" fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke-width:0.5;" width="67" x="150.5" y="959.5469"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53" x="157.5" y="979.542">Outbox</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74" x="286" y="84.1279">OutboxDB</text><path class="s_181818_e7e7e7" d="M308,35.1328 C308,25.1328 326,25.1328 326,25.1328 C326,25.1328 344,25.1328 344,35.1328 L344,61.1328 C344,71.1328 326,71.1328 326,71.1328 C326,71.1328 308,71.1328 308,61.1328 L308,35.1328 " fill="#E2E2F0" style="stroke-width:1.5;"/><path class="s_181818_e7e7e7" d="M308,35.1328 C308,45.1328 326,45.1328 326,45.1328 C326,45.1328 344,45.1328 344,35.1328 " fill="none" style="stroke-width:1.5;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74" x="286" y="972.542">OutboxDB</text><path class="s_181818_e7e7e7" d="M308,985.8438 C308,975.8438 326,975.8438 326,975.8438 C326,975.8438 344,975.8438 344,985.8438 L344,1011.8438 C344,1021.8438 326,1021.8438 326,1021.8438 C326,1021.8438 308,1021.8438 308,1011.8438 L308,985.8438 " fill="#E2E2F0" style="stroke-width:1.5;"/><path class="s_181818_e7e7e7" d="M308,985.8438 C308,995.8438 326,995.8438 326,995.8438 C326,995.8438 344,995.8438 344,985.8438 " fill="none" style="stroke-width:1.5;"/><path class="s_181818_e7e7e7" d="M381,61.1328 L489,61.1328 C494,61.1328 494,74.2813 494,74.2813 C494,74.2813 494,87.4297 489,87.4297 L381,87.4297 C376,87.4297 376,74.2813 376,74.2813 C376,74.2813 376,61.1328 381,61.1328 " fill="#E2E2F0" style="stroke-width:0.5;"/><path class="s_181818_e7e7e7" d="M489,61.1328 C484,61.1328 484,74.2813 484,74.2813 C484,87.4297 489,87.4297 489,87.4297 " fill="none" style="stroke-width:0.5;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98" x="381" y="79.1279">OutboxQueue</text><path class="s_181818_e7e7e7" d="M381,959.5469 L489,959.5469 C494,959.5469 494,972.6953 494,972.6953 C494,972.6953 494,985.8438 489,985.8438 L381,985.8438 C376,985.8438 376,972.6953 376,972.6953 C376,972.6953 376,959.5469 381,959.5469 " fill="#E2E2F0" style="stroke-width:0.5;"/><path class="s_181818_e7e7e7" d="M489,959.5469 C484,959.5469 484,972.6953 484,972.6953 C484,985.8438 489,985.8438 489,985.8438 " fill="none" style="stroke-width:0.5;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98" x="381" y="977.542">OutboxQueue</text><rect class="s_181818_e7e7e7" fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke-width:0.5;" width="54" x="504" y="56.1328"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="511" y="76.1279">KMS1</text><rect class="s_181818_e7e7e7" fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke-width:0.5;" width="54" x="504" y="959.5469"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="511" y="979.542">KMS1</text><rect class="s_181818_e7e7e7" fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke-width:0.5;" width="54" x="568" y="56.1328"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="575" y="76.1279">Inbox</text><rect class="s_181818_e7e7e7" fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke-width:0.5;" width="54" x="568" y="959.5469"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="575" y="979.542">Inbox</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61" x="724.5" y="84.1279">InboxDB</text><path class="s_181818_e7e7e7" d="M740,35.1328 C740,25.1328 758,25.1328 758,25.1328 C758,25.1328 776,25.1328 776,35.1328 L776,61.1328 C776,71.1328 758,71.1328 758,71.1328 C758,71.1328 740,71.1328 740,61.1328 L740,35.1328 " fill="#E2E2F0" style="stroke-width:1.5;"/><path class="s_181818_e7e7e7" d="M740,35.1328 C740,45.1328 758,45.1328 758,45.1328 C758,45.1328 776,45.1328 776,35.1328 " fill="none" style="stroke-width:1.5;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61" x="724.5" y="972.542">InboxDB</text><path class="s_181818_e7e7e7" d="M740,985.8438 C740,975.8438 758,975.8438 758,975.8438 C758,975.8438 776,975.8438 776,985.8438 L776,1011.8438 C776,1021.8438 758,1021.8438 758,1021.8438 C758,1021.8438 740,1021.8438 740,1011.8438 L740,985.8438 " fill="#E2E2F0" style="stroke-width:1.5;"/><path class="s_181818_e7e7e7" d="M740,985.8438 C740,995.8438 758,995.8438 758,995.8438 C758,995.8438 776,995.8438 776,985.8438 " fill="none" style="stroke-width:1.5;"/><path class="s_181818_e7e7e7" d="M806.5,61.1328 L901.5,61.1328 C906.5,61.1328 906.5,74.2813 906.5,74.2813 C906.5,74.2813 906.5,87.4297 901.5,87.4297 L806.5,87.4297 C801.5,87.4297 801.5,74.2813 801.5,74.2813 C801.5,74.2813 801.5,61.1328 806.5,61.1328 " fill="#E2E2F0" style="stroke-width:0.5;"/><path class="s_181818_e7e7e7" d="M901.5,61.1328 C896.5,61.1328 896.5,74.2813 896.5,74.2813 C896.5,87.4297 901.5,87.4297 901.5,87.4297 " fill="none" style="stroke-width:0.5;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85" x="806.5" y="79.1279">InboxQueue</text><path class="s_181818_e7e7e7" d="M806.5,959.5469 L901.5,959.5469 C906.5,959.5469 906.5,972.6953 906.5,972.6953 C906.5,972.6953 906.5,985.8438 901.5,985.8438 L806.5,985.8438 C801.5,985.8438 801.5,972.6953 801.5,972.6953 C801.5,972.6953 801.5,959.5469 806.5,959.5469 " fill="#E2E2F0" style="stroke-width:0.5;"/><path class="s_181818_e7e7e7" d="M901.5,959.5469 C896.5,959.5469 896.5,972.6953 896.5,972.6953 C896.5,985.8438 901.5,985.8438 901.5,985.8438 " fill="none" style="stroke-width:0.5;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85" x="806.5" y="977.542">InboxQueue</text><rect class="f_ffffff_000000 s_181818_e7e7e7" height="183.7969" style="stroke-width:1.0;" width="10" x="179" y="118.5625"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="390.4258" style="stroke-width:1.0;" width="10" x="179" y="349.1914"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="120.9648" style="stroke-width:1.0;" width="10" x="430" y="258.2266"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="29.1328" style="stroke-width:1.0;" width="10" x="526" y="434.0234"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="248.3281" style="stroke-width:1.0;" width="10" x="590" y="549.5547"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="124.5313" style="stroke-width:1.0;" width="10" x="590" y="827.0156"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="173.7969" style="stroke-width:1.0;" width="10" x="849" y="768.75"/><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="167,114.5625,177,118.5625,167,122.5625,171,118.5625" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="80" x2="173" y1="118.5625" y2="118.5625"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80" x="87" y="113.4966">Post Activity</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="314,143.6953,324,147.6953,314,151.6953,318,147.6953" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="189" x2="320" y1="147.6953" y2="147.6953"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86" x="196" y="142.6294">Store Activity</text><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="189" x2="231" y1="191.9609" y2="191.9609"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="231" x2="231" y1="191.9609" y2="204.9609"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="190" x2="231" y1="204.9609" y2="204.9609"/><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="200,200.9609,190,204.9609,200,208.9609,196,204.9609" style="stroke-width:1.0;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="196" y="171.7622">Resolve URIs from</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="196" y="186.895">"to" field"</text><path class="f_eeeeee_555555 s_000000_ffffff" d="M140.5,219.9609 L218.5,219.9609 L218.5,227.0938 L208.5,237.0938 L140.5,237.0938 L140.5,219.9609 " style="stroke-width:1.5;"/><rect class="s_000000_ffffff" fill="none" height="75.3984" style="stroke-width:1.5;" width="363.5" x="140.5" y="219.9609"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="33" x="155.5" y="233.0278">loop</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="92" x="233.5" y="232.1714">[For each URI]</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="418,254.2266,428,258.2266,418,262.2266,422,258.2266" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="189" x2="424" y1="258.2266" y2="258.2266"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="196" y="253.1606">Activity message</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="200,283.3594,190,287.3594,200,291.3594,196,287.3594" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="194" x2="429" y1="287.3594" y2="287.3594"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26" x="206" y="282.2935">ACK</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="200,345.1914,190,349.1914,200,353.1914,196,349.1914" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="194" x2="429" y1="349.1914" y2="349.1914"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="206" y="344.1255">Activity message</text><path class="f_feffdd_333333 s_181818_e7e7e7" d="M5,307.3594 L5,377.3594 L174,377.3594 L174,317.3594 L164,307.3594 L5,307.3594 " style="stroke-width:0.5;"/><path class="f_feffdd_333333 s_181818_e7e7e7" d="M164,307.3594 L164,317.3594 L174,317.3594 L164,307.3594 " style="stroke-width:0.5;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146" x="11" y="324.4263">An Activity message is</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="11" y="339.5591">processed for each URI</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="11" y="354.6919">in the "to" field of</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77" x="11" y="369.8247">the Activity.</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="514,430.0234,524,434.0234,514,438.0234,518,434.0234" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="189" x2="520" y1="434.0234" y2="434.0234"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80" x="196" y="428.9575">Sign request</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="200,459.1563,190,463.1563,200,467.1563,196,463.1563" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="194" x2="530" y1="463.1563" y2="463.1563"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="60" x="206" y="458.0903">signature</text><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="189" x2="231" y1="507.4219" y2="507.4219"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="231" x2="231" y1="507.4219" y2="520.4219"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="190" x2="231" y1="520.4219" y2="520.4219"/><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="200,516.4219,190,520.4219,200,524.4219,196,520.4219" style="stroke-width:1.0;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="196" y="487.2231">Add signature to</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="196" y="502.356">HTTP header</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="578,545.5547,588,549.5547,578,553.5547,582,549.5547" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="189" x2="584" y1="549.5547" y2="549.5547"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="48" x="196" y="544.4888">Activity</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="200,604.9531,190,608.9531,200,612.9531,196,608.9531" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="194" x2="589" y1="608.9531" y2="608.9531"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="206" y="573.6216">Resolve actor</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="206" y="588.7544">in activity</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="206" y="603.8872">using WebFinger</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="578,634.0859,588,638.0859,578,642.0859,582,638.0859" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="189" x2="584" y1="638.0859" y2="638.0859"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="33" x="196" y="633.02">actor</text><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="600" x2="642" y1="697.4844" y2="697.4844"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="642" x2="642" y1="697.4844" y2="710.4844"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="601" x2="642" y1="710.4844" y2="710.4844"/><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="611,706.4844,601,710.4844,611,714.4844,607,710.4844" style="stroke-width:1.0;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139" x="607" y="662.1528">Verify HTTP signature</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="607" y="677.2856">of request using</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="607" y="692.4185">public key of actor</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="195,735.6172,185,739.6172,195,743.6172,191,739.6172" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="189" x2="589" y1="739.6172" y2="739.6172"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="18" x="201" y="734.5513">OK</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="837,764.75,847,768.75,837,772.75,841,768.75" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="600" x2="843" y1="768.75" y2="768.75"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="607" y="763.6841">Activity message</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="606,793.8828,596,797.8828,606,801.8828,602,797.8828" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="600" x2="848" y1="797.8828" y2="797.8828"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26" x="612" y="792.8169">ACK</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="611,823.0156,601,827.0156,611,831.0156,607,827.0156" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="605" x2="848" y1="827.0156" y2="827.0156"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="617" y="821.9497">Activity message</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="746,852.1484,756,856.1484,746,860.1484,750,856.1484" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="600" x2="752" y1="856.1484" y2="856.1484"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86" x="607" y="851.0825">Store Activity</text><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="600" x2="642" y1="900.4141" y2="900.4141"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="642" x2="642" y1="900.4141" y2="913.4141"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="601" x2="642" y1="913.4141" y2="913.4141"/><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="611,909.4141,601,913.4141,611,917.4141,607,913.4141" style="stroke-width:1.0;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="607" y="880.2153">Authorize and</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="607" y="895.3481">Handle Activity</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="842,938.5469,852,942.5469,842,946.5469,846,942.5469" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="600" x2="848" y1="942.5469" y2="942.5469"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26" x="607" y="937.481">ACK</text><!--MD5=[4f815b65266f12881fd4a8e500d627db]
@startuml
'https://plantuml.com/sequence-diagram

actor Domain1Admin
box Domain1 #White
participant Outbox
database OutboxDB
queue OutboxQueue
participant KMS1
end box

box DomainN
participant Inbox
database InboxDB
queue InboxQueue
end box

Domain1Admin -> Outbox: Post Activity

activate Outbox

Outbox -> OutboxDB: Store Activity

Outbox -> Outbox: Resolve URIs from\n"to" field"

loop For each URI

Outbox -> OutboxQueue: Activity message

activate OutboxQueue

OutboxQueue - -> Outbox: ACK

end loop

deactivate Outbox

OutboxQueue -> Outbox: Activity message

note left
An Activity message is
processed for each URI
in the "to" field of
the Activity.
end note

activate Outbox

deactivate OutboxQueue

Outbox -> KMS1: Sign request

activate KMS1

KMS1 - -> Outbox: signature

deactivate KMS1

Outbox -> Outbox: Add signature to\nHTTP header

Outbox -> Inbox: Activity

activate Inbox

Inbox -> Outbox: Resolve actor\nin activity\nusing WebFinger
Outbox - -> Inbox: actor

Inbox -> Inbox: Verify HTTP signature\nof request using\npublic key of actor
Inbox - -> Outbox: OK

deactivate Outbox

Inbox -> InboxQueue: Activity message

activate InboxQueue

InboxQueue - -> Inbox: ACK

deactivate Inbox

InboxQueue -> Inbox: Activity message

activate Inbox

Inbox -> InboxDB: Store Activity

Inbox -> Inbox: Authorize and\nHandle Activity

Inbox - -> InboxQueue: ACK

deactivate InboxQueue
@enduml

@startuml

actor Domain1Admin
box Domain1 #White
participant Outbox
database OutboxDB
queue OutboxQueue
participant KMS1
end box

box DomainN
participant Inbox
database InboxDB
queue InboxQueue
end box

Domain1Admin -> Outbox: Post Activity

activate Outbox

Outbox -> OutboxDB: Store Activity

Outbox -> Outbox: Resolve URIs from\n"to" field"

loop For each URI

Outbox -> OutboxQueue: Activity message

activate OutboxQueue

OutboxQueue - -> Outbox: ACK

end loop

deactivate Outbox

OutboxQueue -> Outbox: Activity message

note left
An Activity message is
processed for each URI
in the "to" field of
the Activity.
end note

activate Outbox

deactivate OutboxQueue

Outbox -> KMS1: Sign request

activate KMS1

KMS1 - -> Outbox: signature

deactivate KMS1

Outbox -> Outbox: Add signature to\nHTTP header

Outbox -> Inbox: Activity

activate Inbox

Inbox -> Outbox: Resolve actor\nin activity\nusing WebFinger
Outbox - -> Inbox: actor

Inbox -> Inbox: Verify HTTP signature\nof request using\npublic key of actor
Inbox - -> Outbox: OK

deactivate Outbox

Inbox -> InboxQueue: Activity message

activate InboxQueue

InboxQueue - -> Inbox: ACK

deactivate Inbox

InboxQueue -> Inbox: Activity message

activate Inbox

Inbox -> InboxDB: Store Activity

Inbox -> Inbox: Authorize and\nHandle Activity

Inbox - -> InboxQueue: ACK

deactivate InboxQueue
@enduml

PlantUML version 1.2022.2beta5(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>