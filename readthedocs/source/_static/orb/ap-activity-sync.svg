<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1002px" preserveAspectRatio="none" style="width:542px;height:1002px;" version="1.1" viewBox="0 0 542 1002" width="542px" zoomAndPan="magnify"><defs><style type="text/css"><![CDATA[*.s_181818_e7e7e7 {stroke:#181818;}*.f_000000_ffffff {fill:#000000;}*.f_dddddd_222222 {fill:#dddddd;}*.f_ffffff_000000 {fill:#ffffff;}*.s_000000_ffffff {stroke:#000000;}*.f_181818_e7e7e7 {fill:#181818;}*.f_eeeeee_555555 {fill:#eeeeee;}*.f_feffdd_333333 {fill:#feffdd;}@media (prefers-color-scheme:dark) {*.s_181818_e7e7e7 {stroke:#e7e7e7;}*.f_000000_ffffff {fill:#ffffff;}*.f_dddddd_222222 {fill:#222222;}*.f_ffffff_000000 {fill:#000000;}*.s_000000_ffffff {stroke:#ffffff;}*.f_181818_e7e7e7 {fill:#e7e7e7;}*.f_eeeeee_555555 {fill:#555555;}*.f_feffdd_333333 {fill:#333333;}}]]></style></defs><g><rect class="s_181818_e7e7e7" fill="#FFFFFF" height="990.8438" style="stroke-width:0.5;" width="388" x="1" y="6"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="66" x="159.5" y="18.0669">Domain1</text><rect class="f_dddddd_222222 s_181818_e7e7e7" height="990.8438" style="stroke-width:0.5;" width="139" x="391" y="6"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="68" x="426.5" y="18.0669">DomainN</text><rect class="f_ffffff_000000 s_181818_e7e7e7" height="775.9844" style="stroke-width:1.0;" width="10" x="186.5" y="132.5625"/><rect class="s_000000_ffffff" height="275.5938" style="stroke-width:1.5;fill:none;" width="411.5" x="99" y="205.8281"/><rect class="s_000000_ffffff" height="82.5313" style="stroke-width:1.5;fill:none;" width="391.5" x="109" y="391.8906"/><rect class="s_000000_ffffff" height="317.7266" style="stroke-width:1.5;fill:none;" width="437" x="99" y="553.6875"/><rect class="s_000000_ffffff" height="67.3984" style="stroke-width:1.5;fill:none;" width="406.5" x="109" y="797.0156"/><line class="s_181818_e7e7e7" style="stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="57" x2="57" y1="101.4297" y2="917.5469"/><line class="s_181818_e7e7e7" style="stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="191" x2="191" y1="101.4297" y2="917.5469"/><line class="s_181818_e7e7e7" style="stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="340" x2="340" y1="101.4297" y2="917.5469"/><line class="s_181818_e7e7e7" style="stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="422" x2="422" y1="101.4297" y2="917.5469"/><line class="s_181818_e7e7e7" style="stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="492" x2="492" y1="101.4297" y2="917.5469"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98" x="5" y="98.1279">Task Manager</text><ellipse class="s_181818_e7e7e7" cx="57" cy="33.6328" fill="#E2E2F0" rx="8" ry="8" style="stroke-width:0.5;"/><path class="s_181818_e7e7e7" d="M57,41.6328 L57,68.6328 M44,49.6328 L70,49.6328 M57,68.6328 L44,83.6328 M57,68.6328 L70,83.6328 " fill="none" style="stroke-width:0.5;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98" x="5" y="929.542">Task Manager</text><ellipse class="s_181818_e7e7e7" cx="57" cy="941.3438" fill="#E2E2F0" rx="8" ry="8" style="stroke-width:0.5;"/><path class="s_181818_e7e7e7" d="M57,949.3438 L57,976.3438 M44,957.3438 L70,957.3438 M57,976.3438 L44,991.3438 M57,976.3438 L70,991.3438 " fill="none" style="stroke-width:0.5;"/><rect class="s_181818_e7e7e7" fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke-width:0.5;" width="145" x="119" y="70.1328"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="131" x="126" y="90.1279">Activity Sync Task</text><rect class="s_181818_e7e7e7" fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke-width:0.5;" width="145" x="119" y="916.5469"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="131" x="126" y="936.542">Activity Sync Task</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83" x="296" y="98.1279">ActivityPub</text><path class="s_181818_e7e7e7" d="M322.5,49.1328 C322.5,39.1328 340.5,39.1328 340.5,39.1328 C340.5,39.1328 358.5,39.1328 358.5,49.1328 L358.5,75.1328 C358.5,85.1328 340.5,85.1328 340.5,85.1328 C340.5,85.1328 322.5,85.1328 322.5,75.1328 L322.5,49.1328 " fill="#E2E2F0" style="stroke-width:1.5;"/><path class="s_181818_e7e7e7" d="M322.5,49.1328 C322.5,59.1328 340.5,59.1328 340.5,59.1328 C340.5,59.1328 358.5,59.1328 358.5,49.1328 " fill="none" style="stroke-width:1.5;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83" x="296" y="929.542">ActivityPub</text><path class="s_181818_e7e7e7" d="M322.5,942.8438 C322.5,932.8438 340.5,932.8438 340.5,932.8438 C340.5,932.8438 358.5,932.8438 358.5,942.8438 L358.5,968.8438 C358.5,978.8438 340.5,978.8438 340.5,978.8438 C340.5,978.8438 322.5,978.8438 322.5,968.8438 L322.5,942.8438 " fill="#E2E2F0" style="stroke-width:1.5;"/><path class="s_181818_e7e7e7" d="M322.5,942.8438 C322.5,952.8438 340.5,952.8438 340.5,952.8438 C340.5,952.8438 358.5,952.8438 358.5,942.8438 " fill="none" style="stroke-width:1.5;"/><rect class="s_181818_e7e7e7" fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke-width:0.5;" width="54" x="395" y="70.1328"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="402" y="90.1279">Inbox</text><rect class="s_181818_e7e7e7" fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke-width:0.5;" width="54" x="395" y="916.5469"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="402" y="936.542">Inbox</text><rect class="s_181818_e7e7e7" fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke-width:0.5;" width="67" x="459" y="70.1328"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53" x="466" y="90.1279">Outbox</text><rect class="s_181818_e7e7e7" fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke-width:0.5;" width="67" x="459" y="916.5469"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53" x="466" y="936.542">Outbox</text><rect class="f_ffffff_000000 s_181818_e7e7e7" height="775.9844" style="stroke-width:1.0;" width="10" x="186.5" y="132.5625"/><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="174.5,128.5625,184.5,132.5625,174.5,136.5625,178.5,132.5625" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="57" x2="180.5" y1="132.5625" y2="132.5625"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="64" y="127.4966">activity sync</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="328.5,157.6953,338.5,161.6953,328.5,165.6953,332.5,161.6953" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="196.5" x2="334.5" y1="161.6953" y2="161.6953"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="203.5" y="156.6294">Get followers</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="207.5,186.8281,197.5,190.8281,207.5,194.8281,203.5,190.8281" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="201.5" x2="339.5" y1="190.8281" y2="190.8281"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="213.5" y="185.7622">followers</text><path class="f_eeeeee_555555 s_000000_ffffff" d="M99,205.8281 L177,205.8281 L177,212.9609 L167,222.9609 L99,222.9609 L99,205.8281 " style="stroke-width:1.5;"/><rect class="s_000000_ffffff" fill="none" height="275.5938" style="stroke-width:1.5;" width="411.5" x="99" y="205.8281"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="33" x="114" y="218.895">loop</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="151" x="192" y="218.0386">[For each follower (N)]</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="328.5,270.3594,338.5,274.3594,328.5,278.3594,332.5,274.3594" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="196.5" x2="334.5" y1="274.3594" y2="274.3594"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="203.5" y="239.0278">Get last processed</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="203.5" y="254.1606">page/index from</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="203.5" y="269.2935">DomainN Inbox</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="207.5,299.4922,197.5,303.4922,207.5,307.4922,203.5,303.4922" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="201.5" x2="339.5" y1="303.4922" y2="303.4922"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="213.5" y="298.4263">page/index</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="410,343.7578,420,347.7578,410,351.7578,414,347.7578" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="196.5" x2="416" y1="347.7578" y2="347.7578"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="203.5" y="327.5591">Get activities starting</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="203.5" y="342.6919">at page/index</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="207.5,372.8906,197.5,376.8906,207.5,380.8906,203.5,376.8906" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="201.5" x2="421" y1="376.8906" y2="376.8906"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="57" x="213.5" y="371.8247">activities</text><path class="f_eeeeee_555555 s_000000_ffffff" d="M109,391.8906 L187,391.8906 L187,399.0234 L177,409.0234 L109,409.0234 L109,391.8906 " style="stroke-width:1.5;"/><rect class="s_000000_ffffff" fill="none" height="82.5313" style="stroke-width:1.5;" width="391.5" x="109" y="391.8906"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="33" x="124" y="404.9575">loop</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="122" x="202" y="404.1011">[For each activity]</text><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="196.5" x2="238.5" y1="441.7891" y2="441.7891"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="238.5" x2="238.5" y1="441.7891" y2="454.7891"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="197.5" x2="238.5" y1="454.7891" y2="454.7891"/><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="207.5,450.7891,197.5,454.7891,207.5,458.7891,203.5,454.7891" style="stroke-width:1.0;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101" x="203.5" y="436.7231">process activity</text><path class="f_feffdd_333333 s_181818_e7e7e7" d="M316,414.0234 L316,469.0234 L480,469.0234 L480,424.0234 L470,414.0234 L316,414.0234 " style="stroke-width:0.5;"/><path class="f_feffdd_333333 s_181818_e7e7e7" d="M470,414.0234 L470,424.0234 L480,424.0234 L470,414.0234 " style="stroke-width:0.5;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="322" y="431.0903">Only process Create</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="322" y="446.2231">activities that were</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="322" y="461.356">published by Domain1</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="328.5,505.5547,338.5,509.5547,328.5,513.5547,332.5,509.5547" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="196.5" x2="334.5" y1="509.5547" y2="509.5547"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="203.5" y="504.4888">Get following</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="207.5,534.6875,197.5,538.6875,207.5,542.6875,203.5,538.6875" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="201.5" x2="339.5" y1="538.6875" y2="538.6875"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="57" x="213.5" y="533.6216">following</text><path class="f_eeeeee_555555 s_000000_ffffff" d="M99,553.6875 L177,553.6875 L177,560.8203 L167,570.8203 L99,570.8203 L99,553.6875 " style="stroke-width:1.5;"/><rect class="s_000000_ffffff" fill="none" height="317.7266" style="stroke-width:1.5;" width="437" x="99" y="553.6875"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="33" x="114" y="566.7544">loop</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="157" x="192" y="565.8979">[For each following (N)]</text><line class="s_181818_e7e7e7" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="196.5" x2="238.5" y1="607.0859" y2="607.0859"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="238.5" x2="238.5" y1="607.0859" y2="620.0859"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="197.5" x2="238.5" y1="620.0859" y2="620.0859"/><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="207.5,616.0859,197.5,620.0859,207.5,624.0859,203.5,620.0859" style="stroke-width:1.0;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="203.5" y="586.8872">Sync Outbox from</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="203.5" y="602.02">DomainN</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="328.5,675.4844,338.5,679.4844,328.5,683.4844,332.5,679.4844" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="196.5" x2="334.5" y1="679.4844" y2="679.4844"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="203.5" y="644.1528">Get last processed</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="203.5" y="659.2856">page/index from</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110" x="203.5" y="674.4185">DomainN Outbox</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="207.5,704.6172,197.5,708.6172,207.5,712.6172,203.5,708.6172" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="201.5" x2="339.5" y1="708.6172" y2="708.6172"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="213.5" y="703.5513">page/index</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="480.5,748.8828,490.5,752.8828,480.5,756.8828,484.5,752.8828" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="196.5" x2="486.5" y1="752.8828" y2="752.8828"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="203.5" y="732.6841">Get activities starting</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="203.5" y="747.8169">at page/index</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="207.5,778.0156,197.5,782.0156,207.5,786.0156,203.5,782.0156" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="201.5" x2="491.5" y1="782.0156" y2="782.0156"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="57" x="213.5" y="776.9497">activities</text><path class="f_eeeeee_555555 s_000000_ffffff" d="M109,797.0156 L187,797.0156 L187,804.1484 L177,814.1484 L109,814.1484 L109,797.0156 " style="stroke-width:1.5;"/><rect class="s_000000_ffffff" fill="none" height="67.3984" style="stroke-width:1.5;" width="406.5" x="109" y="797.0156"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="33" x="124" y="810.0825">loop</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="122" x="202" y="809.2261">[For each activity]</text><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="196.5" x2="238.5" y1="839.3477" y2="839.3477"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="238.5" x2="238.5" y1="839.3477" y2="852.3477"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="197.5" x2="238.5" y1="852.3477" y2="852.3477"/><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="207.5,848.3477,197.5,852.3477,207.5,856.3477,203.5,852.3477" style="stroke-width:1.0;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101" x="203.5" y="834.2817">process activity</text><path class="f_feffdd_333333 s_181818_e7e7e7" d="M316,819.1484 L316,859.1484 L495,859.1484 L495,829.1484 L485,819.1484 L316,819.1484 " style="stroke-width:0.5;"/><path class="f_feffdd_333333 s_181818_e7e7e7" d="M485,819.1484 L485,829.1484 L495,829.1484 L485,819.1484 " style="stroke-width:0.5;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="322" y="836.2153">Only process Create and</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="322" y="851.3481">Announce activities</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="68,895.5469,58,899.5469,68,903.5469,64,899.5469" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="62" x2="185.5" y1="899.5469" y2="899.5469"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="18" x="74" y="894.481">OK</text><!--MD5=[6d3838a5b721c9a35d85014d7ecdcbb4]
@startuml
'https://plantuml.com/sequence-diagram

box Domain1 #White
actor "Task Manager" as taskManager
participant "Activity Sync Task" as activitySyncTask
database "ActivityPub" as activityPubDB
end box

box DomainN
participant "Inbox" as domainNInbox
participant "Outbox" as domainNOutbox
end box

taskManager -> activitySyncTask: activity sync

activate activitySyncTask

activitySyncTask -> activityPubDB: Get followers
activityPubDB - -> activitySyncTask: followers

loop For each follower (N)

activitySyncTask -> activityPubDB: Get last processed\npage/index from\nDomainN Inbox
activityPubDB - -> activitySyncTask: page/index

activitySyncTask -> domainNInbox: Get activities starting\nat page/index
domainNInbox - -> activitySyncTask: activities

loop For each activity
activitySyncTask -> activitySyncTask: process activity
note right
Only process Create
activities that were
published by Domain1
end note
end loop

end loop

activitySyncTask -> activityPubDB: Get following
activityPubDB - -> activitySyncTask: following

loop For each following (N)

activitySyncTask - -> activitySyncTask: Sync Outbox from\nDomainN

activitySyncTask -> activityPubDB: Get last processed\npage/index from\nDomainN Outbox
activityPubDB - -> activitySyncTask: page/index

activitySyncTask -> domainNOutbox: Get activities starting\nat page/index
domainNOutbox - -> activitySyncTask: activities

loop For each activity
activitySyncTask -> activitySyncTask: process activity
note right
Only process Create and
Announce activities
end note
end loop

end loop

activitySyncTask - -> taskManager: OK
@enduml

@startuml

box Domain1 #White
actor "Task Manager" as taskManager
participant "Activity Sync Task" as activitySyncTask
database "ActivityPub" as activityPubDB
end box

box DomainN
participant "Inbox" as domainNInbox
participant "Outbox" as domainNOutbox
end box

taskManager -> activitySyncTask: activity sync

activate activitySyncTask

activitySyncTask -> activityPubDB: Get followers
activityPubDB - -> activitySyncTask: followers

loop For each follower (N)

activitySyncTask -> activityPubDB: Get last processed\npage/index from\nDomainN Inbox
activityPubDB - -> activitySyncTask: page/index

activitySyncTask -> domainNInbox: Get activities starting\nat page/index
domainNInbox - -> activitySyncTask: activities

loop For each activity
activitySyncTask -> activitySyncTask: process activity
note right
Only process Create
activities that were
published by Domain1
end note
end loop

end loop

activitySyncTask -> activityPubDB: Get following
activityPubDB - -> activitySyncTask: following

loop For each following (N)

activitySyncTask - -> activitySyncTask: Sync Outbox from\nDomainN

activitySyncTask -> activityPubDB: Get last processed\npage/index from\nDomainN Outbox
activityPubDB - -> activitySyncTask: page/index

activitySyncTask -> domainNOutbox: Get activities starting\nat page/index
domainNOutbox - -> activitySyncTask: activities

loop For each activity
activitySyncTask -> activitySyncTask: process activity
note right
Only process Create and
Announce activities
end note
end loop

end loop

activitySyncTask - -> taskManager: OK
@enduml

PlantUML version 1.2022.2beta5(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>