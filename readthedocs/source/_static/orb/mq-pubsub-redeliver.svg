<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1996px" preserveAspectRatio="none" style="width:777px;height:1996px;" version="1.1" viewBox="0 0 777 1996" width="777px" zoomAndPan="magnify"><defs><style type="text/css"><![CDATA[*.f_ffffff_000000 {fill:#ffffff;}*.s_181818_e7e7e7 {stroke:#181818;}*.s_000000_ffffff {stroke:#000000;}*.f_000000_ffffff {fill:#000000;}*.f_181818_e7e7e7 {fill:#181818;}*.f_eeeeee_555555 {fill:#eeeeee;}*.f_feffdd_333333 {fill:#feffdd;}@media (prefers-color-scheme:dark) {*.f_ffffff_000000 {fill:#000000;}*.s_181818_e7e7e7 {stroke:#e7e7e7;}*.s_000000_ffffff {stroke:#ffffff;}*.f_000000_ffffff {fill:#ffffff;}*.f_181818_e7e7e7 {fill:#e7e7e7;}*.f_eeeeee_555555 {fill:#555555;}*.f_feffdd_333333 {fill:#333333;}}]]></style></defs><g><rect class="f_ffffff_000000 s_181818_e7e7e7" height="29.1328" style="stroke-width:1.0;" width="10" x="143" y="128.7266"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="29.1328" style="stroke-width:1.0;" width="10" x="143" y="245.2578"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="29.1328" style="stroke-width:1.0;" width="10" x="143" y="361.7891"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="29.1328" style="stroke-width:1.0;" width="10" x="143" y="520.4531"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="109.6641" style="stroke-width:1.0;" width="10" x="143" y="719.3828"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="29.1328" style="stroke-width:1.0;" width="10" x="143" y="1016.8438"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="94.5313" style="stroke-width:1.0;" width="10" x="143" y="1471.1719"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="29.1328" style="stroke-width:1.0;" width="10" x="143" y="1753.5"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="29.1328" style="stroke-width:1.0;" width="10" x="250.5" y="186.9922"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="29.1328" style="stroke-width:1.0;" width="10" x="250.5" y="303.5234"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="29.1328" style="stroke-width:1.0;" width="10" x="250.5" y="578.7188"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="29.1328" style="stroke-width:1.0;" width="10" x="250.5" y="858.1797"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="109.6641" style="stroke-width:1.0;" width="10" x="250.5" y="1258.9766"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="129.5313" style="stroke-width:1.0;" width="10" x="418.5" y="420.0547"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="250.3281" style="stroke-width:1.0;" width="10" x="418.5" y="636.9844"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="168.7344" style="stroke-width:1.0;" width="10" x="418.5" y="1045.9766"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="49.9375" style="stroke-width:1.0;" width="10" x="418.5" y="1782.6328"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="129.5313" style="stroke-width:1.0;" width="10" x="530.5" y="916.4453"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="211.0625" style="stroke-width:1.0;" width="10" x="530.5" y="1412.9063"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="129.5313" style="stroke-width:1.0;" width="10" x="530.5" y="1653.1016"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="109.6641" style="stroke-width:1.0;" width="10" x="642.5" y="1105.0469"/><rect class="s_000000_ffffff" height="1201.5859" style="stroke-width:1.5;fill:none;" width="681.5" x="88.5" y="681.1172"/><line class="s_181818_e7e7e7" style="stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="41" x2="41" y1="97.5938" y2="1899.7031"/><line class="s_181818_e7e7e7" style="stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="147.5" x2="147.5" y1="97.5938" y2="1899.7031"/><line class="s_181818_e7e7e7" style="stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="255.5" x2="255.5" y1="97.5938" y2="1899.7031"/><line class="s_181818_e7e7e7" style="stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="423.5" x2="423.5" y1="97.5938" y2="1899.7031"/><line class="s_181818_e7e7e7" style="stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="535" x2="535" y1="97.5938" y2="1899.7031"/><line class="s_181818_e7e7e7" style="stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="647" x2="647" y1="97.5938" y2="1899.7031"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="5" y="77.9951">Publisher</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43" x="16.5" y="94.292">Client</text><ellipse class="s_181818_e7e7e7" cx="41" cy="13.5" fill="#E2E2F0" rx="8" ry="8" style="stroke-width:0.5;"/><path class="s_181818_e7e7e7" d="M41,21.5 L41,48.5 M28,29.5 L54,29.5 M41,48.5 L28,63.5 M41,48.5 L54,63.5 " fill="none" style="stroke-width:0.5;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="5" y="1911.6982">Publisher</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43" x="16.5" y="1927.9951">Client</text><ellipse class="s_181818_e7e7e7" cx="41" cy="1939.7969" fill="#E2E2F0" rx="8" ry="8" style="stroke-width:0.5;"/><path class="s_181818_e7e7e7" d="M41,1947.7969 L41,1974.7969 M28,1955.7969 L54,1955.7969 M41,1974.7969 L28,1989.7969 M41,1974.7969 L54,1989.7969 " fill="none" style="stroke-width:0.5;"/><path class="s_181818_e7e7e7" d="M103.5,71.2969 L192.5,71.2969 C197.5,71.2969 197.5,84.4453 197.5,84.4453 C197.5,84.4453 197.5,97.5938 192.5,97.5938 L103.5,97.5938 C98.5,97.5938 98.5,84.4453 98.5,84.4453 C98.5,84.4453 98.5,71.2969 103.5,71.2969 " fill="#E2E2F0" style="stroke-width:0.5;"/><path class="s_181818_e7e7e7" d="M192.5,71.2969 C187.5,71.2969 187.5,84.4453 187.5,84.4453 C187.5,97.5938 192.5,97.5938 192.5,97.5938 " fill="none" style="stroke-width:0.5;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="103.5" y="89.292">App Queue</text><path class="s_181818_e7e7e7" d="M103.5,1898.7031 L192.5,1898.7031 C197.5,1898.7031 197.5,1911.8516 197.5,1911.8516 C197.5,1911.8516 197.5,1925 192.5,1925 L103.5,1925 C98.5,1925 98.5,1911.8516 98.5,1911.8516 C98.5,1911.8516 98.5,1898.7031 103.5,1898.7031 " fill="#E2E2F0" style="stroke-width:0.5;"/><path class="s_181818_e7e7e7" d="M192.5,1898.7031 C187.5,1898.7031 187.5,1911.8516 187.5,1911.8516 C187.5,1925 192.5,1925 192.5,1925 " fill="none" style="stroke-width:0.5;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="103.5" y="1916.6982">App Queue</text><path class="s_181818_e7e7e7" d="M212.5,55 L298.5,55 C303.5,55 303.5,76.2969 303.5,76.2969 C303.5,76.2969 303.5,97.5938 298.5,97.5938 L212.5,97.5938 C207.5,97.5938 207.5,76.2969 207.5,76.2969 C207.5,76.2969 207.5,55 212.5,55 " fill="#E2E2F0" style="stroke-width:0.5;"/><path class="s_181818_e7e7e7" d="M298.5,55 C293.5,55 293.5,76.2969 293.5,76.2969 C293.5,97.5938 298.5,97.5938 298.5,97.5938 " fill="none" style="stroke-width:0.5;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76" x="212.5" y="72.9951">Redelivery</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="228" y="89.292">Queue</text><path class="s_181818_e7e7e7" d="M212.5,1898.7031 L298.5,1898.7031 C303.5,1898.7031 303.5,1920 303.5,1920 C303.5,1920 303.5,1941.2969 298.5,1941.2969 L212.5,1941.2969 C207.5,1941.2969 207.5,1920 207.5,1920 C207.5,1920 207.5,1898.7031 212.5,1898.7031 " fill="#E2E2F0" style="stroke-width:0.5;"/><path class="s_181818_e7e7e7" d="M298.5,1898.7031 C293.5,1898.7031 293.5,1920 293.5,1920 C293.5,1941.2969 298.5,1941.2969 298.5,1941.2969 " fill="none" style="stroke-width:0.5;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76" x="212.5" y="1916.6982">Redelivery</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="228" y="1932.9951">Queue</text><rect class="s_181818_e7e7e7" fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke-width:0.5;" width="88" x="379.5" y="50"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="27" x="410" y="69.9951">Orb</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74" x="386.5" y="86.292">Instance 1</text><rect class="s_181818_e7e7e7" fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke-width:0.5;" width="88" x="379.5" y="1898.7031"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="27" x="410" y="1918.6982">Orb</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74" x="386.5" y="1934.9951">Instance 1</text><rect class="s_181818_e7e7e7" fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke-width:0.5;" width="87" x="492" y="50"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="27" x="522" y="69.9951">Orb</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73" x="499" y="86.292">Instance 2</text><rect class="s_181818_e7e7e7" fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke-width:0.5;" width="87" x="492" y="1898.7031"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="27" x="522" y="1918.6982">Orb</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73" x="499" y="1934.9951">Instance 2</text><path class="s_181818_e7e7e7" d="M620,55 L675,55 C680,55 680,76.2969 680,76.2969 C680,76.2969 680,97.5938 675,97.5938 L620,97.5938 C615,97.5938 615,76.2969 615,76.2969 C615,76.2969 615,55 620,55 " fill="#E2E2F0" style="stroke-width:0.5;"/><path class="s_181818_e7e7e7" d="M675,55 C670,55 670,76.2969 670,76.2969 C670,97.5938 675,97.5938 675,97.5938 " fill="none" style="stroke-width:0.5;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="33" x="626" y="72.9951">Wait</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="620" y="89.292">Queue</text><path class="s_181818_e7e7e7" d="M620,1898.7031 L675,1898.7031 C680,1898.7031 680,1920 680,1920 C680,1920 680,1941.2969 675,1941.2969 L620,1941.2969 C615,1941.2969 615,1920 615,1920 C615,1920 615,1898.7031 620,1898.7031 " fill="#E2E2F0" style="stroke-width:0.5;"/><path class="s_181818_e7e7e7" d="M675,1898.7031 C670,1898.7031 670,1920 670,1920 C670,1941.2969 675,1941.2969 675,1941.2969 " fill="none" style="stroke-width:0.5;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="33" x="626" y="1916.6982">Wait</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="620" y="1932.9951">Queue</text><rect class="f_ffffff_000000 s_181818_e7e7e7" height="29.1328" style="stroke-width:1.0;" width="10" x="143" y="128.7266"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="29.1328" style="stroke-width:1.0;" width="10" x="143" y="245.2578"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="29.1328" style="stroke-width:1.0;" width="10" x="143" y="361.7891"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="29.1328" style="stroke-width:1.0;" width="10" x="143" y="520.4531"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="109.6641" style="stroke-width:1.0;" width="10" x="143" y="719.3828"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="29.1328" style="stroke-width:1.0;" width="10" x="143" y="1016.8438"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="94.5313" style="stroke-width:1.0;" width="10" x="143" y="1471.1719"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="29.1328" style="stroke-width:1.0;" width="10" x="143" y="1753.5"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="29.1328" style="stroke-width:1.0;" width="10" x="250.5" y="186.9922"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="29.1328" style="stroke-width:1.0;" width="10" x="250.5" y="303.5234"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="29.1328" style="stroke-width:1.0;" width="10" x="250.5" y="578.7188"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="29.1328" style="stroke-width:1.0;" width="10" x="250.5" y="858.1797"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="109.6641" style="stroke-width:1.0;" width="10" x="250.5" y="1258.9766"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="129.5313" style="stroke-width:1.0;" width="10" x="418.5" y="420.0547"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="250.3281" style="stroke-width:1.0;" width="10" x="418.5" y="636.9844"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="168.7344" style="stroke-width:1.0;" width="10" x="418.5" y="1045.9766"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="49.9375" style="stroke-width:1.0;" width="10" x="418.5" y="1782.6328"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="129.5313" style="stroke-width:1.0;" width="10" x="530.5" y="916.4453"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="211.0625" style="stroke-width:1.0;" width="10" x="530.5" y="1412.9063"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="129.5313" style="stroke-width:1.0;" width="10" x="530.5" y="1653.1016"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="109.6641" style="stroke-width:1.0;" width="10" x="642.5" y="1105.0469"/><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="164,124.7266,154,128.7266,164,132.7266,160,128.7266" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="158" x2="422.5" y1="128.7266" y2="128.7266"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="170" y="123.6606">subscribe</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="411.5,153.8594,421.5,157.8594,411.5,161.8594,415.5,157.8594" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="148" x2="417.5" y1="157.8594" y2="157.8594"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="155" y="152.7935">ok</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="271.5,182.9922,261.5,186.9922,271.5,190.9922,267.5,186.9922" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="265.5" x2="422.5" y1="186.9922" y2="186.9922"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="277.5" y="181.9263">subscribe</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="411.5,212.125,421.5,216.125,411.5,220.125,415.5,216.125" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="255.5" x2="417.5" y1="216.125" y2="216.125"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="262.5" y="211.0591">ok</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="164,241.2578,154,245.2578,164,249.2578,160,245.2578" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="158" x2="534.5" y1="245.2578" y2="245.2578"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="170" y="240.1919">subscribe</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="523.5,270.3906,533.5,274.3906,523.5,278.3906,527.5,274.3906" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="148" x2="529.5" y1="274.3906" y2="274.3906"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="155" y="269.3247">ok</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="271.5,299.5234,261.5,303.5234,271.5,307.5234,267.5,303.5234" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="265.5" x2="534.5" y1="303.5234" y2="303.5234"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="277.5" y="298.4575">subscribe</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="523.5,328.6563,533.5,332.6563,523.5,336.6563,527.5,332.6563" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="255.5" x2="529.5" y1="332.6563" y2="332.6563"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="262.5" y="327.5903">ok</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="131,357.7891,141,361.7891,131,365.7891,135,361.7891" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="41" x2="137" y1="361.7891" y2="361.7891"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="48" y="356.7231">publish(msg)</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="52,386.9219,42,390.9219,52,394.9219,48,390.9219" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="46" x2="147" y1="390.9219" y2="390.9219"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="58" y="385.856">ok</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="406.5,416.0547,416.5,420.0547,406.5,424.0547,410.5,420.0547" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="148" x2="412.5" y1="420.0547" y2="420.0547"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="28" x="155" y="414.9888">msg</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="159,445.1875,149,449.1875,159,453.1875,155,449.1875" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="153" x2="417.5" y1="449.1875" y2="449.1875"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="165" y="444.1216">ok</text><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="428.5" x2="470.5" y1="478.3203" y2="478.3203"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="470.5" x2="470.5" y1="478.3203" y2="491.3203"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="429.5" x2="470.5" y1="491.3203" y2="491.3203"/><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="439.5,487.3203,429.5,491.3203,439.5,495.3203,435.5,491.3203" style="stroke-width:1.0;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="435.5" y="473.2544">process(msg)</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="164,516.4531,154,520.4531,164,524.4531,160,520.4531" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="158" x2="417.5" y1="520.4531" y2="520.4531"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="31" x="170" y="515.3872">Nack</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="411.5,545.5859,421.5,549.5859,411.5,553.5859,415.5,549.5859" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="148" x2="417.5" y1="549.5859" y2="549.5859"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="155" y="544.52">ok</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="238.5,574.7188,248.5,578.7188,238.5,582.7188,242.5,578.7188" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="148" x2="244.5" y1="578.7188" y2="578.7188"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="28" x="155" y="573.6528">msg</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="159,603.8516,149,607.8516,159,611.8516,155,607.8516" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="153" x2="254.5" y1="607.8516" y2="607.8516"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="165" y="602.7856">ok</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="406.5,632.9844,416.5,636.9844,406.5,640.9844,410.5,636.9844" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="255.5" x2="412.5" y1="636.9844" y2="636.9844"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="262.5" y="631.9185">msg(reason=rejected)</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="266.5,662.1172,256.5,666.1172,266.5,670.1172,262.5,666.1172" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="260.5" x2="417.5" y1="666.1172" y2="666.1172"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="272.5" y="661.0513">ok</text><path class="f_eeeeee_555555 s_000000_ffffff" d="M88.5,681.1172 L154.5,681.1172 L154.5,688.25 L144.5,698.25 L88.5,698.25 L88.5,681.1172 " style="stroke-width:1.5;"/><rect class="s_000000_ffffff" fill="none" height="1201.5859" style="stroke-width:1.5;" width="681.5" x="88.5" y="681.1172"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="103.5" y="694.1841">alt</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="156" x="169.5" y="693.3276">[Redelivery count == 0]</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="164,715.3828,154,719.3828,164,723.3828,160,719.3828" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="158" x2="417.5" y1="719.3828" y2="719.3828"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="170" y="714.3169">msg(redeliveryCount=1)</text><path class="f_feffdd_333333 s_181818_e7e7e7" d="M334,732.3828 L334,802.3828 L513,802.3828 L513,742.3828 L503,732.3828 L334,732.3828 " style="stroke-width:0.5;"/><path class="f_feffdd_333333 s_181818_e7e7e7" d="M503,732.3828 L503,742.3828 L513,742.3828 L503,732.3828 " style="stroke-width:0.5;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="340" y="749.4497">Increment the redelivery</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="340" y="764.5825">count in the message's</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141" x="340" y="779.7153">metadata and re-post</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80" x="340" y="794.8481">immediately</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="406.5,825.0469,416.5,829.0469,406.5,833.0469,410.5,829.0469" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="148" x2="412.5" y1="829.0469" y2="829.0469"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="155" y="823.981">ok</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="271.5,854.1797,261.5,858.1797,271.5,862.1797,267.5,858.1797" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="265.5" x2="417.5" y1="858.1797" y2="858.1797"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23" x="277.5" y="853.1138">Ack</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="411.5,883.3125,421.5,887.3125,411.5,891.3125,415.5,887.3125" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="255.5" x2="417.5" y1="887.3125" y2="887.3125"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="262.5" y="882.2466">ok</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="518.5,912.4453,528.5,916.4453,518.5,920.4453,522.5,916.4453" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="148" x2="524.5" y1="916.4453" y2="916.4453"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="155" y="911.3794">msg(redeliveryCount=1)</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="159,941.5781,149,945.5781,159,949.5781,155,945.5781" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="153" x2="529.5" y1="945.5781" y2="945.5781"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="165" y="940.5122">ok</text><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="540.5" x2="582.5" y1="974.7109" y2="974.7109"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="582.5" x2="582.5" y1="974.7109" y2="987.7109"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="541.5" x2="582.5" y1="987.7109" y2="987.7109"/><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="551.5,983.7109,541.5,987.7109,551.5,991.7109,547.5,987.7109" style="stroke-width:1.0;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="547.5" y="969.645">process(msg)</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="164,1012.8438,154,1016.8438,164,1020.8438,160,1016.8438" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="158" x2="529.5" y1="1016.8438" y2="1016.8438"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23" x="170" y="1011.7778">Ack</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="523.5,1041.9766,533.5,1045.9766,523.5,1049.9766,527.5,1045.9766" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="148" x2="529.5" y1="1045.9766" y2="1045.9766"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="155" y="1040.9106">ok</text><line class="s_000000_ffffff" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="88.5" x2="770" y1="1054.9766" y2="1054.9766"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="147" x="93.5" y="1065.187">[Redelivery count &gt; 0]</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="630.5,1101.0469,640.5,1105.0469,630.5,1109.0469,634.5,1105.0469" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="428.5" x2="636.5" y1="1105.0469" y2="1105.0469"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="435.5" y="1084.8481">msg(redeliverCount=1;</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="435.5" y="1099.981">expiration=2s)</text><path class="f_feffdd_333333 s_181818_e7e7e7" d="M322,1118.0469 L322,1188.0469 L525,1188.0469 L525,1128.0469 L515,1118.0469 L322,1118.0469 " style="stroke-width:0.5;"/><path class="f_feffdd_333333 s_181818_e7e7e7" d="M515,1118.0469 L515,1128.0469 L525,1128.0469 L515,1118.0469 " style="stroke-width:0.5;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162" x="328" y="1135.1138">Send the message to the</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="328" y="1150.2466">wait queue with 'expiration'</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182" x="328" y="1165.3794">header so that the message</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47" x="328" y="1180.5122">expires</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="434.5,1210.7109,424.5,1214.7109,434.5,1218.7109,430.5,1214.7109" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="428.5" x2="646.5" y1="1214.7109" y2="1214.7109"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="440.5" y="1209.645">ok</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="271.5,1254.9766,261.5,1258.9766,271.5,1262.9766,267.5,1258.9766" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="265.5" x2="646.5" y1="1258.9766" y2="1258.9766"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="277.5" y="1238.7778">msg(reason=expired;</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="277.5" y="1253.9106">redeliveryCount=1)</text><path class="f_feffdd_333333 s_181818_e7e7e7" d="M535,1271.9766 L535,1341.9766 L760,1341.9766 L760,1281.9766 L750,1271.9766 L535,1271.9766 " style="stroke-width:0.5;"/><path class="f_feffdd_333333 s_181818_e7e7e7" d="M750,1271.9766 L750,1281.9766 L760,1281.9766 L750,1271.9766 " style="stroke-width:0.5;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203" x="541" y="1289.0435">The message expires (after the</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="204" x="541" y="1304.1763">time specified in the 'expiration'</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183" x="541" y="1319.3091">header) and is automatically</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182" x="541" y="1334.4419">sent to the redelivery queue</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="635.5,1364.6406,645.5,1368.6406,635.5,1372.6406,639.5,1368.6406" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="255.5" x2="641.5" y1="1368.6406" y2="1368.6406"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="262.5" y="1363.5747">ok</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="518.5,1408.9063,528.5,1412.9063,518.5,1416.9063,522.5,1412.9063" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="255.5" x2="524.5" y1="1412.9063" y2="1412.9063"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="262.5" y="1392.7075">msg(reason=expired;</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="262.5" y="1407.8403">redeliverCount=1)</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="266.5,1438.0391,256.5,1442.0391,266.5,1446.0391,262.5,1442.0391" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="260.5" x2="529.5" y1="1442.0391" y2="1442.0391"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="272.5" y="1436.9731">ok</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="164,1467.1719,154,1471.1719,164,1475.1719,160,1471.1719" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="158" x2="529.5" y1="1471.1719" y2="1471.1719"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="170" y="1466.106">msg(redeliveryCount=2)</text><path class="f_feffdd_333333 s_181818_e7e7e7" d="M446,1484.1719 L446,1539.1719 L625,1539.1719 L625,1494.1719 L615,1484.1719 L446,1484.1719 " style="stroke-width:0.5;"/><path class="f_feffdd_333333 s_181818_e7e7e7" d="M615,1484.1719 L615,1494.1719 L625,1494.1719 L615,1484.1719 " style="stroke-width:0.5;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="452" y="1501.2388">Increment the redelivery</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="452" y="1516.3716">count and re-post</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="452" y="1531.5044">the message</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="518.5,1561.7031,528.5,1565.7031,518.5,1569.7031,522.5,1565.7031" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="148" x2="524.5" y1="1565.7031" y2="1565.7031"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="155" y="1560.6372">ok</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="266.5,1590.8359,256.5,1594.8359,266.5,1598.8359,262.5,1594.8359" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="260.5" x2="529.5" y1="1594.8359" y2="1594.8359"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23" x="272.5" y="1589.77">Ack</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="523.5,1619.9688,533.5,1623.9688,523.5,1627.9688,527.5,1623.9688" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="255.5" x2="529.5" y1="1623.9688" y2="1623.9688"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="262.5" y="1618.9028">ok</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="518.5,1649.1016,528.5,1653.1016,518.5,1657.1016,522.5,1653.1016" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="148" x2="524.5" y1="1653.1016" y2="1653.1016"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="155" y="1648.0356">msg(redeliveryCount=2)</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="159,1678.2344,149,1682.2344,159,1686.2344,155,1682.2344" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="153" x2="529.5" y1="1682.2344" y2="1682.2344"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="165" y="1677.1685">ok</text><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="540.5" x2="582.5" y1="1711.3672" y2="1711.3672"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="582.5" x2="582.5" y1="1711.3672" y2="1724.3672"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="541.5" x2="582.5" y1="1724.3672" y2="1724.3672"/><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="551.5,1720.3672,541.5,1724.3672,551.5,1728.3672,547.5,1724.3672" style="stroke-width:1.0;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="547.5" y="1706.3013">process(msg)</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="164,1749.5,154,1753.5,164,1757.5,160,1753.5" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="158" x2="529.5" y1="1753.5" y2="1753.5"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23" x="170" y="1748.4341">Ack</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="523.5,1778.6328,533.5,1782.6328,523.5,1786.6328,527.5,1782.6328" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="148" x2="529.5" y1="1782.6328" y2="1782.6328"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="155" y="1777.5669">ok</text><line class="s_000000_ffffff" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="88.5" x2="770" y1="1791.6328" y2="1791.6328"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="303" x="93.5" y="1801.8433">[Redelivery count &gt; max redelivery attempts]</text><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="428.5" x2="470.5" y1="1831.5703" y2="1831.5703"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="470.5" x2="470.5" y1="1831.5703" y2="1844.5703"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="423.5" x2="470.5" y1="1844.5703" y2="1844.5703"/><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="433.5,1840.5703,423.5,1844.5703,433.5,1848.5703,429.5,1844.5703" style="stroke-width:1.0;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="435.5" y="1826.5044">Log warning</text><path class="f_feffdd_333333 s_181818_e7e7e7" d="M340,1852.5703 L340,1877.5703 L506,1877.5703 L506,1862.5703 L496,1852.5703 L340,1852.5703 " style="stroke-width:0.5;"/><path class="f_feffdd_333333 s_181818_e7e7e7" d="M496,1852.5703 L496,1862.5703 L506,1862.5703 L496,1852.5703 " style="stroke-width:0.5;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="346" y="1869.6372">Abandon the message</text><!--MD5=[cc094c362e890d37f43fffcfa98a064f]
@startuml
'https://plantuml.com/sequence-diagram

actor "Publisher\nClient" as client

queue "App Queue" as queue1
queue "Redelivery\nQueue" as redeliveryQueue

participant "Orb\nInstance 1" as service1
participant "Orb\nInstance 2" as service2

queue "Wait\nQueue" as waitQueue

service1 -> queue1: subscribe
activate queue1
  queue1 - -> service1: ok
deactivate queue1

service1 -> redeliveryQueue: subscribe
activate redeliveryQueue
  redeliveryQueue - -> service1: ok
deactivate redeliveryQueue

service2 -> queue1: subscribe
activate queue1
  queue1 - -> service2: ok
deactivate queue1

service2 -> redeliveryQueue: subscribe
activate redeliveryQueue
  redeliveryQueue - -> service2: ok
deactivate redeliveryQueue

client -> queue1: publish(msg)
activate queue1
  queue1 - -> client: ok
deactivate queue1

queue1 -> service1: msg

activate service1
service1 - -> queue1: ok
service1 -> service1: process(msg)

service1 -> queue1: Nack
activate queue1
queue1 - -> service1: ok
deactivate queue1
deactivate service1

queue1 -> redeliveryQueue: msg
activate redeliveryQueue
redeliveryQueue - -> queue1: ok
deactivate redeliveryQueue

redeliveryQueue -> service1: msg(reason=rejected)
activate service1

service1 - -> redeliveryQueue: ok

alt Redelivery count == 0
  service1 -> queue1: msg(redeliveryCount=1)

  note over service1
  Increment the redelivery
  count in the message's
  metadata and re-post
  immediately
  end note

  activate queue1
  queue1 - -> service1: ok
  deactivate queue1

  service1 -> redeliveryQueue: Ack
  activate redeliveryQueue
  redeliveryQueue - -> service1: ok
  deactivate redeliveryQueue
  deactivate service1

  queue1 -> service2: msg(redeliveryCount=1)

  activate service2
  service2 - -> queue1: ok
  service2 -> service2: process(msg)

  service2 -> queue1: Ack
  activate queue1
  queue1 - -> service2: ok
  deactivate queue1
  deactivate service2
else Redelivery count > 0
  activate service1
  service1 -> waitQueue: msg(redeliverCount=1;\nexpiration=2s)

  note over service1
    Send the message to the
    wait queue with 'expiration'
    header so that the message
    expires
  end note

  activate waitQueue
  waitQueue - -> service1: ok
  deactivate waitQueue
  deactivate service1

  waitQueue -> redeliveryQueue: msg(reason=expired;\nredeliveryCount=1)

  note over waitQueue
  The message expires (after the
  time specified in the 'expiration'
  header) and is automatically
  sent to the redelivery queue
  end note

  activate redeliveryQueue
  redeliveryQueue - -> waitQueue: ok
  deactivate redeliveryQueue

  redeliveryQueue -> service2: msg(reason=expired;\nredeliverCount=1)
  activate service2
  service2 - -> redeliveryQueue: ok

  service2 -> queue1: msg(redeliveryCount=2)

  note over service2
  Increment the redelivery
  count and re-post
  the message
  end note

  activate queue1
  queue1 - -> service2: ok
  deactivate queue1
  service2 -> redeliveryQueue: Ack
  redeliveryQueue - -> service2: ok
  deactivate service2

  queue1 -> service2: msg(redeliveryCount=2)

  activate service2
  service2 - -> queue1: ok
  service2 -> service2: process(msg)

  service2 -> queue1: Ack
  activate queue1
  queue1 - -> service2: ok
  deactivate queue1
  deactivate service2
else Redelivery count > max redelivery attempts
  activate service1
  service1 -> service1: Log warning
  note over service1: Abandon the message
  deactivate service1
end

deactivate service1
@enduml

@startuml

actor "Publisher\nClient" as client

queue "App Queue" as queue1
queue "Redelivery\nQueue" as redeliveryQueue

participant "Orb\nInstance 1" as service1
participant "Orb\nInstance 2" as service2

queue "Wait\nQueue" as waitQueue

service1 -> queue1: subscribe
activate queue1
  queue1 - -> service1: ok
deactivate queue1

service1 -> redeliveryQueue: subscribe
activate redeliveryQueue
  redeliveryQueue - -> service1: ok
deactivate redeliveryQueue

service2 -> queue1: subscribe
activate queue1
  queue1 - -> service2: ok
deactivate queue1

service2 -> redeliveryQueue: subscribe
activate redeliveryQueue
  redeliveryQueue - -> service2: ok
deactivate redeliveryQueue

client -> queue1: publish(msg)
activate queue1
  queue1 - -> client: ok
deactivate queue1

queue1 -> service1: msg

activate service1
service1 - -> queue1: ok
service1 -> service1: process(msg)

service1 -> queue1: Nack
activate queue1
queue1 - -> service1: ok
deactivate queue1
deactivate service1

queue1 -> redeliveryQueue: msg
activate redeliveryQueue
redeliveryQueue - -> queue1: ok
deactivate redeliveryQueue

redeliveryQueue -> service1: msg(reason=rejected)
activate service1

service1 - -> redeliveryQueue: ok

alt Redelivery count == 0
  service1 -> queue1: msg(redeliveryCount=1)

  note over service1
  Increment the redelivery
  count in the message's
  metadata and re-post
  immediately
  end note

  activate queue1
  queue1 - -> service1: ok
  deactivate queue1

  service1 -> redeliveryQueue: Ack
  activate redeliveryQueue
  redeliveryQueue - -> service1: ok
  deactivate redeliveryQueue
  deactivate service1

  queue1 -> service2: msg(redeliveryCount=1)

  activate service2
  service2 - -> queue1: ok
  service2 -> service2: process(msg)

  service2 -> queue1: Ack
  activate queue1
  queue1 - -> service2: ok
  deactivate queue1
  deactivate service2
else Redelivery count > 0
  activate service1
  service1 -> waitQueue: msg(redeliverCount=1;\nexpiration=2s)

  note over service1
    Send the message to the
    wait queue with 'expiration'
    header so that the message
    expires
  end note

  activate waitQueue
  waitQueue - -> service1: ok
  deactivate waitQueue
  deactivate service1

  waitQueue -> redeliveryQueue: msg(reason=expired;\nredeliveryCount=1)

  note over waitQueue
  The message expires (after the
  time specified in the 'expiration'
  header) and is automatically
  sent to the redelivery queue
  end note

  activate redeliveryQueue
  redeliveryQueue - -> waitQueue: ok
  deactivate redeliveryQueue

  redeliveryQueue -> service2: msg(reason=expired;\nredeliverCount=1)
  activate service2
  service2 - -> redeliveryQueue: ok

  service2 -> queue1: msg(redeliveryCount=2)

  note over service2
  Increment the redelivery
  count and re-post
  the message
  end note

  activate queue1
  queue1 - -> service2: ok
  deactivate queue1
  service2 -> redeliveryQueue: Ack
  redeliveryQueue - -> service2: ok
  deactivate service2

  queue1 -> service2: msg(redeliveryCount=2)

  activate service2
  service2 - -> queue1: ok
  service2 -> service2: process(msg)

  service2 -> queue1: Ack
  activate queue1
  queue1 - -> service2: ok
  deactivate queue1
  deactivate service2
else Redelivery count > max redelivery attempts
  activate service1
  service1 -> service1: Log warning
  note over service1: Abandon the message
  deactivate service1
end

deactivate service1
@enduml

PlantUML version 1.2022.2beta5(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>