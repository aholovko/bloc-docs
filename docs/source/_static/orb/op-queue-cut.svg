<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1002px" preserveAspectRatio="none" style="width:660px;height:1002px;" version="1.1" viewBox="0 0 660 1002" width="660px" zoomAndPan="magnify"><defs><style type="text/css"><![CDATA[*.f_ffffff_000000 {fill:#ffffff;}*.s_181818_e7e7e7 {stroke:#181818;}*.s_000000_ffffff {stroke:#000000;}*.f_000000_ffffff {fill:#000000;}*.f_181818_e7e7e7 {fill:#181818;}*.f_eeeeee_555555 {fill:#eeeeee;}*.f_feffdd_333333 {fill:#feffdd;}@media (prefers-color-scheme:dark) {*.f_ffffff_000000 {fill:#000000;}*.s_181818_e7e7e7 {stroke:#e7e7e7;}*.s_000000_ffffff {stroke:#ffffff;}*.f_000000_ffffff {fill:#ffffff;}*.f_181818_e7e7e7 {fill:#e7e7e7;}*.f_eeeeee_555555 {fill:#555555;}*.f_feffdd_333333 {fill:#333333;}}]]></style></defs><g><rect class="f_ffffff_000000 s_181818_e7e7e7" height="774.7891" style="stroke-width:1.0;" width="10" x="124" y="114.7266"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="724.5234" style="stroke-width:1.0;" width="10" x="284" y="143.8594"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="47.2656" style="stroke-width:1.0;" width="10" x="423" y="403.1875"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="47.2656" style="stroke-width:1.0;" width="10" x="423" y="776.9844"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="29.1328" style="stroke-width:1.0;" width="10" x="514" y="693.5859"/><rect class="s_000000_ffffff" height="543.7266" style="stroke-width:1.5;fill:none;" width="602" x="51" y="317.6563"/><rect class="s_000000_ffffff" height="155.9297" style="stroke-width:1.5;fill:none;" width="432" x="211" y="574.7891"/><line class="s_181818_e7e7e7" style="stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="28" x2="28" y1="83.5938" y2="907.5156"/><line class="s_181818_e7e7e7" style="stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="129" x2="129" y1="83.5938" y2="907.5156"/><line class="s_181818_e7e7e7" style="stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="289" x2="289" y1="83.5938" y2="907.5156"/><line class="s_181818_e7e7e7" style="stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="428" x2="428" y1="83.5938" y2="907.5156"/><line class="s_181818_e7e7e7" style="stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="519" x2="519" y1="83.5938" y2="907.5156"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="5" y="80.292">timer</text><ellipse class="s_181818_e7e7e7" cx="28" cy="15.7969" fill="#E2E2F0" rx="8" ry="8" style="stroke-width:0.5;"/><path class="s_181818_e7e7e7" d="M28,23.7969 L28,50.7969 M15,31.7969 L41,31.7969 M28,50.7969 L15,65.7969 M28,50.7969 L41,65.7969 " fill="none" style="stroke-width:0.5;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="5" y="919.5107">timer</text><ellipse class="s_181818_e7e7e7" cx="28" cy="931.3125" fill="#E2E2F0" rx="8" ry="8" style="stroke-width:0.5;"/><path class="s_181818_e7e7e7" d="M28,939.3125 L28,966.3125 M15,947.3125 L41,947.3125 M28,966.3125 L15,981.3125 M28,966.3125 L41,981.3125 " fill="none" style="stroke-width:0.5;"/><rect class="s_181818_e7e7e7" fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke-width:0.5;" width="136" x="61" y="52.2969"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="122" x="68" y="72.292">sidetree-core-go</text><rect class="s_181818_e7e7e7" fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke-width:0.5;" width="136" x="61" y="906.5156"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="122" x="68" y="926.5107">sidetree-core-go</text><rect class="s_181818_e7e7e7" fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke-width:0.5;" width="136" x="221" y="52.2969"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="122" x="228" y="72.292">Operation Queue</text><rect class="s_181818_e7e7e7" fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke-width:0.5;" width="136" x="221" y="906.5156"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="122" x="228" y="926.5107">Operation Queue</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="391" y="63.9951">op-queue</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="21" x="414.5" y="80.292">DB</text><path class="s_181818_e7e7e7" d="M410,15 C410,5 428,5 428,5 C428,5 446,5 446,15 L446,41 C446,51 428,51 428,51 C428,51 410,51 410,41 L410,15 " fill="#E2E2F0" style="stroke-width:1.5;"/><path class="s_181818_e7e7e7" d="M410,15 C410,25 428,25 428,25 C428,25 446,25 446,15 " fill="none" style="stroke-width:1.5;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="391" y="919.5107">op-queue</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="21" x="414.5" y="935.8076">DB</text><path class="s_181818_e7e7e7" d="M410,949.1094 C410,939.1094 428,939.1094 428,939.1094 C428,939.1094 446,939.1094 446,949.1094 L446,975.1094 C446,985.1094 428,985.1094 428,985.1094 C428,985.1094 410,985.1094 410,975.1094 L410,949.1094 " fill="#E2E2F0" style="stroke-width:1.5;"/><path class="s_181818_e7e7e7" d="M410,949.1094 C410,959.1094 428,959.1094 428,959.1094 C428,959.1094 446,959.1094 446,949.1094 " fill="none" style="stroke-width:1.5;"/><path class="s_181818_e7e7e7" d="M480,41 L558,41 C563,41 563,62.2969 563,62.2969 C563,62.2969 563,83.5938 558,83.5938 L480,83.5938 C475,83.5938 475,62.2969 475,62.2969 C475,62.2969 475,41 480,41 " fill="#E2E2F0" style="stroke-width:0.5;"/><path class="s_181818_e7e7e7" d="M558,41 C553,41 553,62.2969 553,62.2969 C553,83.5938 558,83.5938 558,83.5938 " fill="none" style="stroke-width:0.5;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="493" y="58.9951">AMQP</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="480" y="75.292">op-queue</text><path class="s_181818_e7e7e7" d="M480,906.5156 L558,906.5156 C563,906.5156 563,927.8125 563,927.8125 C563,927.8125 563,949.1094 558,949.1094 L480,949.1094 C475,949.1094 475,927.8125 475,927.8125 C475,927.8125 475,906.5156 480,906.5156 " fill="#E2E2F0" style="stroke-width:0.5;"/><path class="s_181818_e7e7e7" d="M558,906.5156 C553,906.5156 553,927.8125 553,927.8125 C553,949.1094 558,949.1094 558,949.1094 " fill="none" style="stroke-width:0.5;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="493" y="924.5107">AMQP</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="480" y="940.8076">op-queue</text><rect class="f_ffffff_000000 s_181818_e7e7e7" height="774.7891" style="stroke-width:1.0;" width="10" x="124" y="114.7266"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="724.5234" style="stroke-width:1.0;" width="10" x="284" y="143.8594"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="47.2656" style="stroke-width:1.0;" width="10" x="423" y="403.1875"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="47.2656" style="stroke-width:1.0;" width="10" x="423" y="776.9844"/><rect class="f_ffffff_000000 s_181818_e7e7e7" height="29.1328" style="stroke-width:1.0;" width="10" x="514" y="693.5859"/><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="112,110.7266,122,114.7266,112,118.7266,116,114.7266" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="28" x2="118" y1="114.7266" y2="114.7266"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77" x="35" y="109.6606">BatchCut(N)</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="272,139.8594,282,143.8594,272,147.8594,276,143.8594" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="134" x2="278" y1="143.8594" y2="143.8594"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="73" x="141" y="138.7935">Remove(N)</text><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="294" x2="336" y1="203.2578" y2="203.2578"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="336" x2="336" y1="203.2578" y2="216.2578"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="295" x2="336" y1="216.2578" y2="216.2578"/><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="305,212.2578,295,216.2578,305,220.2578,301,216.2578" style="stroke-width:1.0;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="301" y="167.9263">remove up to N</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="301" y="183.0591">operations from</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115" x="301" y="198.1919">in-memory queue</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="145,256.5234,135,260.5234,145,264.5234,141,260.5234" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="139" x2="283" y1="260.5234" y2="260.5234"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="151" y="240.3247">operations, ack and</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93" x="151" y="255.4575">nack functions</text><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="134" x2="176" y1="289.6563" y2="289.6563"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="176" x2="176" y1="289.6563" y2="302.6563"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="135" x2="176" y1="302.6563" y2="302.6563"/><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="145,298.6563,135,302.6563,145,306.6563,141,302.6563" style="stroke-width:1.0;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="141" y="284.5903">process(ops)</text><path class="f_eeeeee_555555 s_000000_ffffff" d="M51,317.6563 L117,317.6563 L117,324.7891 L107,334.7891 L51,334.7891 L51,317.6563 " style="stroke-width:1.5;"/><rect class="s_000000_ffffff" fill="none" height="543.7266" style="stroke-width:1.5;" width="602" x="51" y="317.6563"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="66" y="330.7231">alt</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="215" x="132" y="329.8667">[Process operations successful]</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="272,351.9219,282,355.9219,272,359.9219,276,355.9219" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="134" x2="278" y1="355.9219" y2="355.9219"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="22" x="141" y="350.856">ack</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="411,399.1875,421,403.1875,411,407.1875,415,403.1875" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="294" x2="417" y1="403.1875" y2="403.1875"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="75" x="301" y="398.1216">Delete(ops)</text><path class="f_feffdd_333333 s_181818_e7e7e7" d="M438,368.9219 L438,423.9219 L588,423.9219 L588,378.9219 L578,368.9219 L438,368.9219 " style="stroke-width:0.5;"/><path class="f_feffdd_333333 s_181818_e7e7e7" d="M578,368.9219 L578,378.9219 L588,378.9219 L578,368.9219 " style="stroke-width:0.5;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="444" y="385.9888">Delete the removed</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="444" y="401.1216">operations from the</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="60" x="444" y="416.2544">database</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="305,446.4531,295,450.4531,305,454.4531,301,450.4531" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="299" x2="427" y1="450.4531" y2="450.4531"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="311" y="445.3872">ok</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="145,475.5859,135,479.5859,145,483.5859,141,479.5859" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="139" x2="283" y1="479.5859" y2="479.5859"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="151" y="474.52">ok</text><line class="s_000000_ffffff" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="51" x2="653" y1="488.5859" y2="488.5859"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="184" x="56" y="498.7964">[Process operations failed]</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="272,537.6563,282,541.6563,272,545.6563,276,541.6563" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="134" x2="278" y1="541.6563" y2="541.6563"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="30" x="141" y="536.5903">nack</text><path class="f_feffdd_333333 s_181818_e7e7e7" d="M299,507.3906 L299,562.3906 L480,562.3906 L480,517.3906 L470,507.3906 L299,507.3906 " style="stroke-width:0.5;"/><path class="f_feffdd_333333 s_181818_e7e7e7" d="M470,507.3906 L470,517.3906 L480,517.3906 L470,507.3906 " style="stroke-width:0.5;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="305" y="524.4575">Repost the operations</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="305" y="539.5903">to the AMQP queue so</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="305" y="554.7231">that they are redelivered</text><path class="f_eeeeee_555555 s_000000_ffffff" d="M211,574.7891 L289,574.7891 L289,581.9219 L279,591.9219 L211,591.9219 L211,574.7891 " style="stroke-width:1.5;"/><rect class="s_000000_ffffff" fill="none" height="155.9297" style="stroke-width:1.5;" width="432" x="211" y="574.7891"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="33" x="226" y="587.856">loop</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="132" x="304" y="586.9995">[For each op in ops]</text><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="294" x2="336" y1="632.2539" y2="632.2539"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="336" x2="336" y1="632.2539" y2="645.2539"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="295" x2="336" y1="645.2539" y2="645.2539"/><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="305,641.2539,295,645.2539,305,649.2539,301,645.2539" style="stroke-width:1.0;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="301" y="627.188">Check retries</text><path class="f_feffdd_333333 s_181818_e7e7e7" d="M397,596.9219 L397,666.9219 L623,666.9219 L623,606.9219 L613,596.9219 L397,596.9219 " style="stroke-width:0.5;"/><path class="f_feffdd_333333 s_181818_e7e7e7" d="M613,596.9219 L613,606.9219 L623,606.9219 L613,596.9219 " style="stroke-width:0.5;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161" x="403" y="613.9888">If retries has reached the</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170" x="403" y="629.1216">retry limit then discard the</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205" x="403" y="644.2544">operation, otherwise, increment</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181" x="403" y="659.3872">the retry count and repost it</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="502,689.5859,512,693.5859,502,697.5859,506,693.5859" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="294" x2="508" y1="693.5859" y2="693.5859"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="301" y="688.52">Publish(op)</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="305,718.7188,295,722.7188,305,726.7188,301,722.7188" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="299" x2="518" y1="722.7188" y2="722.7188"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="311" y="717.6528">ok</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="411,772.9844,421,776.9844,411,780.9844,415,776.9844" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;" x1="294" x2="417" y1="776.9844" y2="776.9844"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="75" x="301" y="771.9185">Delete(ops)</text><path class="f_feffdd_333333 s_181818_e7e7e7" d="M438,742.7188 L438,797.7188 L587,797.7188 L587,752.7188 L577,742.7188 L438,742.7188 " style="stroke-width:0.5;"/><path class="f_feffdd_333333 s_181818_e7e7e7" d="M577,742.7188 L577,752.7188 L587,752.7188 L577,742.7188 " style="stroke-width:0.5;"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="444" y="759.7856">Delete the failed</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="444" y="774.9185">operations from the</text><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="60" x="444" y="790.0513">database</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="305,820.25,295,824.25,305,828.25,301,824.25" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="299" x2="427" y1="824.25" y2="824.25"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="311" y="819.1841">ok</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="145,849.3828,135,853.3828,145,857.3828,141,853.3828" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="139" x2="283" y1="853.3828" y2="853.3828"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="151" y="848.3169">ok</text><polygon class="f_181818_e7e7e7 s_181818_e7e7e7" points="39,885.5156,29,889.5156,39,893.5156,35,889.5156" style="stroke-width:1.0;"/><line class="s_181818_e7e7e7" style="stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="33" x2="128" y1="889.5156" y2="889.5156"/><text class="f_000000_ffffff" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="45" y="884.4497">ok</text><!--MD5=[6ad953669fd60aa28d7ba9c576f03c90]
@startuml
'https://plantuml.com/sequence-diagram

actor timer

participant "sidetree-core-go" as client

participant "Operation Queue" as handler

database "op-queue\nDB" as opQueueDB
queue "AMQP\nop-queue" as opQueue

timer -> client: BatchCut(N)

activate client

client -> handler: Remove(N)

activate handler
  handler -> handler: remove up to N\noperations from\nin-memory queue
  handler - -> client: operations, ack and\nnack functions

  client -> client: process(ops)

alt Process operations successful
  client -> handler: ack

  handler -> opQueueDB: Delete(ops)
  activate opQueueDB

  note right
    Delete the removed
    operations from the
    database
  end note

  opQueueDB - -> handler: ok
  deactivate opQueueDB
  handler - -> client: ok
else Process operations failed
  client -> handler: nack

  note right
    Repost the operations
    to the AMQP queue so
    that they are redelivered
  end note

  loop For each op in ops
    handler -> handler: Check retries

    note right
      If retries has reached the
      retry limit then discard the
      operation, otherwise, increment
      the retry count and repost it
    end note

    handler -> opQueue: Publish(op)
    activate opQueue
    opQueue - -> handler: ok
    deactivate opQueue
  end loop

  handler -> opQueueDB: Delete(ops)
  activate opQueueDB

  note right
    Delete the failed
    operations from the
    database
  end note

  opQueueDB - -> handler: ok
  deactivate opQueueDB

  handler - -> client: ok
end

deactivate handler

client - -> timer: ok

deactivate client
@enduml

@startuml

actor timer

participant "sidetree-core-go" as client

participant "Operation Queue" as handler

database "op-queue\nDB" as opQueueDB
queue "AMQP\nop-queue" as opQueue

timer -> client: BatchCut(N)

activate client

client -> handler: Remove(N)

activate handler
  handler -> handler: remove up to N\noperations from\nin-memory queue
  handler - -> client: operations, ack and\nnack functions

  client -> client: process(ops)

alt Process operations successful
  client -> handler: ack

  handler -> opQueueDB: Delete(ops)
  activate opQueueDB

  note right
    Delete the removed
    operations from the
    database
  end note

  opQueueDB - -> handler: ok
  deactivate opQueueDB
  handler - -> client: ok
else Process operations failed
  client -> handler: nack

  note right
    Repost the operations
    to the AMQP queue so
    that they are redelivered
  end note

  loop For each op in ops
    handler -> handler: Check retries

    note right
      If retries has reached the
      retry limit then discard the
      operation, otherwise, increment
      the retry count and repost it
    end note

    handler -> opQueue: Publish(op)
    activate opQueue
    opQueue - -> handler: ok
    deactivate opQueue
  end loop

  handler -> opQueueDB: Delete(ops)
  activate opQueueDB

  note right
    Delete the failed
    operations from the
    database
  end note

  opQueueDB - -> handler: ok
  deactivate opQueueDB

  handler - -> client: ok
end

deactivate handler

client - -> timer: ok

deactivate client
@enduml

PlantUML version 1.2022.2beta5(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>