<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1004px" preserveAspectRatio="none" style="width:730px;height:1004px;background:#FFFFFF;" version="1.1" viewBox="0 0 730 1004" width="730px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="992.25" style="stroke:#181818;stroke-width:0.5;" width="387" x="26" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="66" x="184" y="18.0669">Domain1</text><rect fill="#DDDDDD" height="992.25" style="stroke:#181818;stroke-width:0.5;" width="214" x="493" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="66" x="567" y="18.0669">Domain2</text><rect fill="#FFFFFF" height="743.7969" style="stroke:#181818;stroke-width:1.0;" width="10" x="144.5" y="148.8594"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="318.5" y="307.5234"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="318.5" y="505.125"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="381.5" y="177.9922"/><rect fill="#FFFFFF" height="614.2656" style="stroke:#181818;stroke-width:1.0;" width="10" x="522.5" y="278.3906"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="663.5" y="783.2578"/><rect height="491.8672" style="stroke:#000000;stroke-width:1.5;fill:none;" width="713" x="10" y="393.7891"/><rect height="206.7344" style="stroke:#000000;stroke-width:1.5;fill:none;" width="693" x="20" y="671.9219"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="59" x2="59" y1="117.7266" y2="902.6563"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="149" x2="149" y1="117.7266" y2="902.6563"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="323" x2="323" y1="117.7266" y2="902.6563"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="386" x2="386" y1="117.7266" y2="902.6563"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="527" x2="527" y1="117.7266" y2="902.6563"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="668" x2="668" y1="117.7266" y2="902.6563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="27" x="43" y="98.1279">Orb</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53" x="30" y="114.4248">Service</text><ellipse cx="59.5" cy="33.6328" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M59.5,41.6328 L59.5,68.6328 M46.5,49.6328 L72.5,49.6328 M59.5,68.6328 L46.5,83.6328 M59.5,68.6328 L72.5,83.6328 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="27" x="43" y="914.6514">Orb</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53" x="30" y="930.9482">Service</text><ellipse cx="59.5" cy="942.75" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M59.5,950.75 L59.5,977.75 M46.5,958.75 L72.5,958.75 M59.5,977.75 L46.5,992.75 M59.5,977.75 L72.5,992.75 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="57" x="121" y="70.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37" x="131" y="90.1279">HTTP</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43" x="128" y="106.4248">Client</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="57" x="121" y="901.6563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37" x="131" y="921.6514">HTTP</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43" x="128" y="937.9482">Client</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="61" x="293" y="70.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37" x="305" y="90.1279">HTTP</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47" x="300" y="106.4248">Server</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="61" x="293" y="901.6563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37" x="305" y="921.6514">HTTP</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47" x="300" y="937.9482">Server</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="45" x="364" y="86.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="371" y="106.4248">KMS</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="45" x="364" y="901.6563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="371" y="921.6514">KMS</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="61" x="497" y="70.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37" x="509" y="90.1279">HTTP</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47" x="504" y="106.4248">Server</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="61" x="497" y="901.6563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37" x="509" y="921.6514">HTTP</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47" x="504" y="937.9482">Server</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="69" x="634" y="70.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37" x="650" y="90.1279">REST</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="641" y="106.4248">Handler</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="69" x="634" y="901.6563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37" x="650" y="921.6514">REST</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="641" y="937.9482">Handler</text><rect fill="#FFFFFF" height="743.7969" style="stroke:#181818;stroke-width:1.0;" width="10" x="144.5" y="148.8594"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="318.5" y="307.5234"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="318.5" y="505.125"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="381.5" y="177.9922"/><rect fill="#FFFFFF" height="614.2656" style="stroke:#181818;stroke-width:1.0;" width="10" x="522.5" y="278.3906"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="663.5" y="783.2578"/><polygon fill="#181818" points="132.5,144.8594,142.5,148.8594,132.5,152.8594,136.5,148.8594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="59.5" x2="138.5" y1="148.8594" y2="148.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="66.5" y="143.7935">send(req)</text><polygon fill="#181818" points="369.5,173.9922,379.5,177.9922,369.5,181.9922,373.5,177.9922" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="154.5" x2="375.5" y1="177.9922" y2="177.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="161.5" y="172.9263">sign(headers)</text><polygon fill="#181818" points="165.5,203.125,155.5,207.125,165.5,211.125,161.5,207.125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="159.5" x2="385.5" y1="207.125" y2="207.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="60" x="171.5" y="202.0591">signature</text><line style="stroke:#181818;stroke-width:1.0;" x1="154.5" x2="196.5" y1="236.2578" y2="236.2578"/><line style="stroke:#181818;stroke-width:1.0;" x1="196.5" x2="196.5" y1="236.2578" y2="249.2578"/><line style="stroke:#181818;stroke-width:1.0;" x1="155.5" x2="196.5" y1="249.2578" y2="249.2578"/><polygon fill="#181818" points="165.5,245.2578,155.5,249.2578,165.5,253.2578,161.5,249.2578" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="161.5" y="231.1919">add headers to request</text><polygon fill="#181818" points="510.5,274.3906,520.5,278.3906,510.5,282.3906,514.5,278.3906" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="154.5" x2="516.5" y1="278.3906" y2="278.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93" x="161.5" y="273.3247">POST(request)</text><polygon fill="#181818" points="339.5,303.5234,329.5,307.5234,339.5,311.5234,335.5,307.5234" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="333.5" x2="521.5" y1="307.5234" y2="307.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="345.5" y="302.4575">GET(keyID)</text><polygon fill="#181818" points="510.5,332.6563,520.5,336.6563,510.5,340.6563,514.5,336.6563" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="323.5" x2="516.5" y1="336.6563" y2="336.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="330.5" y="331.5903">publicKey</text><line style="stroke:#181818;stroke-width:1.0;" x1="532.5" x2="574.5" y1="365.7891" y2="365.7891"/><line style="stroke:#181818;stroke-width:1.0;" x1="574.5" x2="574.5" y1="365.7891" y2="378.7891"/><line style="stroke:#181818;stroke-width:1.0;" x1="533.5" x2="574.5" y1="378.7891" y2="378.7891"/><polygon fill="#181818" points="543.5,374.7891,533.5,378.7891,543.5,382.7891,539.5,378.7891" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="539.5" y="360.7231">Verify(Signature)</text><path d="M10,393.7891 L76,393.7891 L76,400.9219 L66,410.9219 L10,410.9219 L10,393.7891 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="491.8672" style="stroke:#000000;stroke-width:1.5;" width="713" x="10" y="393.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="25" y="406.856">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="121" x="91" y="405.9995">[Invalid signature]</text><polygon fill="#181818" points="165.5,428.0547,155.5,432.0547,165.5,436.0547,161.5,432.0547" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="159.5" x2="521.5" y1="432.0547" y2="432.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="171.5" y="426.9888">HTTP 401</text><polygon fill="#181818" points="70.5,457.1875,60.5,461.1875,70.5,465.1875,66.5,461.1875" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="64.5" x2="143.5" y1="461.1875" y2="461.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="76.5" y="456.1216">HTTP 401</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="723" y1="470.1875" y2="470.1875"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="111" x="15" y="480.3979">[Valid signature]</text><polygon fill="#181818" points="339.5,501.125,329.5,505.125,339.5,509.125,335.5,505.125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="333.5" x2="521.5" y1="505.125" y2="505.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141" x="345.5" y="500.0591">GET(publicKey.owner)</text><polygon fill="#181818" points="510.5,530.2578,520.5,534.2578,510.5,538.2578,514.5,534.2578" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="323.5" x2="516.5" y1="534.2578" y2="534.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170" x="330.5" y="529.1919">ActivityPub Service (actor)</text><line style="stroke:#181818;stroke-width:1.0;" x1="532.5" x2="574.5" y1="563.3906" y2="563.3906"/><line style="stroke:#181818;stroke-width:1.0;" x1="574.5" x2="574.5" y1="563.3906" y2="576.3906"/><line style="stroke:#181818;stroke-width:1.0;" x1="533.5" x2="574.5" y1="576.3906" y2="576.3906"/><polygon fill="#181818" points="543.5,572.3906,533.5,576.3906,543.5,580.3906,539.5,576.3906" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="539.5" y="558.3247">Validate actor</text><path d="M426,589.3906 L426,659.3906 L628,659.3906 L628,599.3906 L618,589.3906 L426,589.3906 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M618,589.3906 L618,599.3906 L628,599.3906 L618,589.3906 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="432" y="606.4575">Verify that the public</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178" x="432" y="621.5903">key ID in the actor (Service)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181" x="432" y="636.7231">matches the ID of the public</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="432" y="651.856">key used for verification</text><path d="M20,671.9219 L86,671.9219 L86,679.0547 L76,689.0547 L20,689.0547 L20,671.9219 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="206.7344" style="stroke:#000000;stroke-width:1.5;" width="693" x="20" y="671.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="35" y="684.9888">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="94" x="101" y="684.1323">[Invalid actor]</text><polygon fill="#181818" points="165.5,706.1875,155.5,710.1875,165.5,714.1875,161.5,710.1875" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="159.5" x2="521.5" y1="710.1875" y2="710.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="171.5" y="705.1216">HTTP 401</text><polygon fill="#181818" points="70.5,735.3203,60.5,739.3203,70.5,743.3203,66.5,739.3203" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="64.5" x2="143.5" y1="739.3203" y2="739.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="76.5" y="734.2544">HTTP 401</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="20" x2="713" y1="748.3203" y2="748.3203"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="84" x="25" y="758.5308">[Valid actor]</text><polygon fill="#181818" points="651.5,779.2578,661.5,783.2578,651.5,787.2578,655.5,783.2578" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="532.5" x2="657.5" y1="783.2578" y2="783.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112" x="539.5" y="778.1919">Handle(req,actor)</text><polygon fill="#181818" points="543.5,808.3906,533.5,812.3906,543.5,816.3906,539.5,812.3906" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="537.5" x2="667.5" y1="812.3906" y2="812.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="549.5" y="807.3247">response</text><polygon fill="#181818" points="165.5,837.5234,155.5,841.5234,165.5,845.5234,161.5,841.5234" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="159.5" x2="521.5" y1="841.5234" y2="841.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="171.5" y="836.4575">response</text><polygon fill="#181818" points="70.5,866.6563,60.5,870.6563,70.5,874.6563,66.5,870.6563" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="64.5" x2="143.5" y1="870.6563" y2="870.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="76.5" y="865.5903">response</text><!--MD5=[d7bd6468eab7d26823dc393808fcc107]
@startuml
'https://plantuml.com/sequence-diagram


box Domain1 #White
actor "Orb\nService" as service1
participant "HTTP\nClient" as client1
participant "HTTP\nServer" as apService1
participant "KMS" as kms1
end box

box Domain2
participant "HTTP\nServer" as server2
participant "REST\nHandler" as handler2
end box

service1 -> client1: send(req)

activate client1

client1 -> kms1: sign(headers)
activate kms1
kms1 - -> client1: signature
deactivate kms1

client1 -> client1: add headers to request

client1 -> server2: POST(request)

activate server2

server2 -> apService1: GET(keyID)
activate apService1
apService1 - -> server2: publicKey
deactivate apService1

server2 -> server2: Verify(Signature)

alt Invalid signature
  server2 - -> client1: HTTP 401
  client1 - -> service1: HTTP 401
else Valid signature
  server2 -> apService1: GET(publicKey.owner)

  activate apService1
  apService1 - -> server2: ActivityPub Service (actor)
  deactivate apService1

  server2 -> server2: Validate actor

  note over server2
    Verify that the public
    key ID in the actor (Service)
    matches the ID of the public
    key used for verification
  end note

  alt Invalid actor
    server2 - -> client1: HTTP 401
    client1 - -> service1: HTTP 401
  else Valid actor
    server2 -> handler2: Handle(req,actor)

    activate handler2
    handler2 - -> server2: response
    deactivate handler2

    server2 - -> client1: response
    client1 - -> service1: response
  end alt
end alt


deactivate server2

deactivate client1
@enduml

@startuml


box Domain1 #White
actor "Orb\nService" as service1
participant "HTTP\nClient" as client1
participant "HTTP\nServer" as apService1
participant "KMS" as kms1
end box

box Domain2
participant "HTTP\nServer" as server2
participant "REST\nHandler" as handler2
end box

service1 -> client1: send(req)

activate client1

client1 -> kms1: sign(headers)
activate kms1
kms1 - -> client1: signature
deactivate kms1

client1 -> client1: add headers to request

client1 -> server2: POST(request)

activate server2

server2 -> apService1: GET(keyID)
activate apService1
apService1 - -> server2: publicKey
deactivate apService1

server2 -> server2: Verify(Signature)

alt Invalid signature
  server2 - -> client1: HTTP 401
  client1 - -> service1: HTTP 401
else Valid signature
  server2 -> apService1: GET(publicKey.owner)

  activate apService1
  apService1 - -> server2: ActivityPub Service (actor)
  deactivate apService1

  server2 -> server2: Validate actor

  note over server2
    Verify that the public
    key ID in the actor (Service)
    matches the ID of the public
    key used for verification
  end note

  alt Invalid actor
    server2 - -> client1: HTTP 401
    client1 - -> service1: HTTP 401
  else Valid actor
    server2 -> handler2: Handle(req,actor)

    activate handler2
    handler2 - -> server2: response
    deactivate handler2

    server2 - -> client1: response
    client1 - -> service1: response
  end alt
end alt


deactivate server2

deactivate client1
@enduml

PlantUML version 1.2022.2beta6(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>