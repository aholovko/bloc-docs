<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2341px" preserveAspectRatio="none" style="width:1467px;height:2341px;" version="1.1" viewBox="0 0 1467 2341" width="1467px" zoomAndPan="magnify"><defs><filter height="300%" id="fnm3mvmd6y9rx" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="412" x="525.5" y="28.708">Blinded routing through User selected route</text><rect fill="#FFFFFF" filter="url(#fnm3mvmd6y9rx)" height="162.7969" style="stroke: #000000; stroke-width: 2.0;" width="455" x="320.5" y="140.25"/><rect fill="#FFFFFF" filter="url(#fnm3mvmd6y9rx)" height="716.7188" style="stroke: #000000; stroke-width: 2.0;" width="1132.5" x="320.5" y="357.8516"/><rect fill="#FFFFFF" filter="url(#fnm3mvmd6y9rx)" height="962.7813" style="stroke: #000000; stroke-width: 2.0;" width="1394" x="10" y="1129.375"/><rect fill="#FFFFFF" filter="url(#fnm3mvmd6y9rx)" height="133.6641" style="stroke: #000000; stroke-width: 2.0;" width="1209.5" x="10" y="2106.1563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="69" x2="69" y1="123.25" y2="310.0469"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="69" x2="69" y1="310.0469" y2="350.8516"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="69" x2="69" y1="350.8516" y2="1081.5703"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="69" x2="69" y1="1081.5703" y2="1122.375"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="69" x2="69" y1="1122.375" y2="2256.8203"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="354.5" x2="354.5" y1="123.25" y2="310.0469"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="354.5" x2="354.5" y1="310.0469" y2="350.8516"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="354.5" x2="354.5" y1="350.8516" y2="1081.5703"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="354.5" x2="354.5" y1="1081.5703" y2="1122.375"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="354.5" x2="354.5" y1="1122.375" y2="2256.8203"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="733.5" x2="733.5" y1="123.25" y2="310.0469"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="733.5" x2="733.5" y1="310.0469" y2="350.8516"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="733.5" x2="733.5" y1="350.8516" y2="1081.5703"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="733.5" x2="733.5" y1="1081.5703" y2="1122.375"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="733.5" x2="733.5" y1="1122.375" y2="2256.8203"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1147.5" x2="1147.5" y1="123.25" y2="310.0469"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="1147.5" x2="1147.5" y1="310.0469" y2="350.8516"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1147.5" x2="1147.5" y1="350.8516" y2="1081.5703"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="1147.5" x2="1147.5" y1="1081.5703" y2="1122.375"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1147.5" x2="1147.5" y1="1122.375" y2="2256.8203"/><rect fill="#FEFECE" filter="url(#fnm3mvmd6y9rx)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="20" y="87.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="27" y="107.9482">rp_adapter</text><rect fill="#FEFECE" filter="url(#fnm3mvmd6y9rx)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="20" y="2255.8203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="27" y="2275.8154">rp_adapter</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="330.5" y="119.9482">wallet</text><ellipse cx="355" cy="49.9531" fill="#FEFECE" filter="url(#fnm3mvmd6y9rx)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M355,57.9531 L355,84.9531 M342,65.9531 L368,65.9531 M355,84.9531 L342,99.9531 M355,84.9531 L368,99.9531 " fill="none" filter="url(#fnm3mvmd6y9rx)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="330.5" y="2268.8154">wallet</text><ellipse cx="355" cy="2282.1172" fill="#FEFECE" filter="url(#fnm3mvmd6y9rx)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M355,2290.1172 L355,2317.1172 M342,2298.1172 L368,2298.1172 M355,2317.1172 L342,2332.1172 M355,2317.1172 L368,2332.1172 " fill="none" filter="url(#fnm3mvmd6y9rx)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#fnm3mvmd6y9rx)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="59" x="702.5" y="87.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="45" x="709.5" y="107.9482">router</text><rect fill="#FEFECE" filter="url(#fnm3mvmd6y9rx)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="59" x="702.5" y="2255.8203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="45" x="709.5" y="2275.8154">router</text><rect fill="#FEFECE" filter="url(#fnm3mvmd6y9rx)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="119" x="1086.5" y="87.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="1093.5" y="107.9482">issuer_adapter</text><rect fill="#FEFECE" filter="url(#fnm3mvmd6y9rx)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="119" x="1086.5" y="2255.8203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="1093.5" y="2275.8154">issuer_adapter</text><path d="M320.5,140.25 L503.5,140.25 L503.5,147.25 L493.5,157.25 L320.5,157.25 L320.5,140.25 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="162.7969" style="stroke: #000000; stroke-width: 2.0;" width="455" x="320.5" y="140.25"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="138" x="335.5" y="153.3169">Wallet onboarding</text><polygon fill="#A80036" points="722,174.5156,732,178.5156,722,182.5156,726,178.5156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="355" x2="728" y1="178.5156" y2="178.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="268" x="362" y="173.4497">HTTP POST Generate DIDComm invitation</text><polygon fill="#A80036" points="366,203.6484,356,207.6484,366,211.6484,362,207.6484" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="360" x2="733" y1="207.6484" y2="207.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="372" y="202.5825">HTTP 200 Invitation</text><polygon fill="#A80036" points="366,232.7813,356,236.7813,366,240.7813,362,236.7813" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="722,232.7813,732,236.7813,722,240.7813,726,236.7813" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="360" x2="728" y1="236.7813" y2="236.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="372" y="231.7153">DIDComm (DIDExchange)</text><polygon fill="#A80036" points="722,261.9141,732,265.9141,722,269.9141,726,265.9141" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="355" x2="728" y1="265.9141" y2="265.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="362" y="260.8481">DIDComm (register route)</text><polygon fill="#A80036" points="366,291.0469,356,295.0469,366,299.0469,362,295.0469" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="360" x2="733" y1="295.0469" y2="295.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="372" y="289.981">DIDComm (register success)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="252" x="482.5" y="334.2573">when user wants to connect issuer to wallet</text><path d="M320.5,357.8516 L533.5,357.8516 L533.5,364.8516 L523.5,374.8516 L320.5,374.8516 L320.5,357.8516 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="716.7188" style="stroke: #000000; stroke-width: 2.0;" width="1132.5" x="320.5" y="357.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="168" x="335.5" y="370.9185">Issuer-Wallet Connect</text><polygon fill="#A80036" points="366,407.25,356,411.25,366,415.25,362,411.25" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="360" x2="1147" y1="411.25" y2="411.25"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="372" y="391.0513">CHAPI Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="257" x="372" y="406.1841">(DIDComm invitation + Governance VC)</text><polygon fill="#A80036" points="1136,436.3828,1146,440.3828,1136,444.3828,1140,440.3828" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="355" x2="1142" y1="440.3828" y2="440.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="362" y="435.3169">DIDComm (DID Exchange)</text><polygon fill="#A80036" points="745,465.5156,735,469.5156,745,473.5156,741,469.5156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="739" x2="1147" y1="469.5156" y2="469.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="751" y="464.4497">DIDComm Forward (DID Exchange)</text><polygon fill="#A80036" points="366,494.6484,356,498.6484,366,502.6484,362,498.6484" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="360" x2="733" y1="498.6484" y2="498.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="372" y="493.5825">DIDComm (DID Exchange)</text><polygon fill="#A80036" points="1136,538.9141,1146,542.9141,1136,546.9141,1140,542.9141" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="355" x2="1142" y1="542.9141" y2="542.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="362" y="522.7153">DIDComm (TBD Protocol)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="362" y="537.8481">Request PeerDID for router</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1148" x2="1190" y1="572.0469" y2="572.0469"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1190" x2="1190" y1="572.0469" y2="585.0469"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1149" x2="1190" y1="585.0469" y2="585.0469"/><polygon fill="#A80036" points="1159,581.0469,1149,585.0469,1159,589.0469,1155,585.0469" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="1155" y="566.981">create new PeerDID</text><polygon fill="#A80036" points="745,625.3125,735,629.3125,745,633.3125,741,629.3125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="739" x2="1147" y1="629.3125" y2="629.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="314" x="751" y="609.1138">DIDComm Forward (RFC0351-PurposeDecorator)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="751" y="624.2466">Issuer PeerDID for router</text><polygon fill="#A80036" points="366,669.5781,356,673.5781,366,677.5781,362,673.5781" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="360" x2="733" y1="673.5781" y2="673.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="372" y="653.3794">DIDComm (RFC0351-PurposeDecorator)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="372" y="668.5122">Issuer PeerDID for router</text><polygon fill="#A80036" points="722,713.8438,732,717.8438,722,721.8438,726,717.8438" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="355" x2="728" y1="717.8438" y2="717.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="362" y="697.645">DIDComm (RFC0351-PurposeDecorator)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="355" x="362" y="712.7778">Request PeerDID for issuer (pass issuer peerDID in req)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="734" x2="776" y1="746.9766" y2="746.9766"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="776" x2="776" y1="746.9766" y2="759.9766"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="735" x2="776" y1="759.9766" y2="759.9766"/><polygon fill="#A80036" points="745,755.9766,735,759.9766,745,763.9766,741,759.9766" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="400" x="741" y="741.9106">create new PeerDID and manual connection record with issuer</text><polygon fill="#A80036" points="366,800.2422,356,804.2422,366,808.2422,362,804.2422" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="360" x2="733" y1="804.2422" y2="804.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="372" y="784.0435">DIDComm (RFC0351-PurposeDecorator)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="372" y="799.1763">Router PeerDID for issuer</text><polygon fill="#A80036" points="1136,844.5078,1146,848.5078,1136,852.5078,1140,848.5078" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="355" x2="1142" y1="848.5078" y2="848.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="362" y="828.3091">DIDComm (RFC0351-PurposeDecorator)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="362" y="843.4419">Send Router PeerDID</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1148" x2="1190" y1="877.6406" y2="877.6406"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1190" x2="1190" y1="877.6406" y2="890.6406"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1149" x2="1190" y1="890.6406" y2="890.6406"/><polygon fill="#A80036" points="1159,886.6406,1149,890.6406,1159,894.6406,1155,890.6406" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="286" x="1155" y="872.5747">create manual connection record with router</text><polygon fill="#A80036" points="745,915.7734,735,919.7734,745,923.7734,741,919.7734" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="739" x2="1147" y1="919.7734" y2="919.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="751" y="914.7075">DIDComm (register route)</text><polygon fill="#A80036" points="1136,944.9063,1146,948.9063,1136,952.9063,1140,948.9063" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="734" x2="1142" y1="948.9063" y2="948.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="741" y="943.8403">DIDComm (register success)</text><polygon fill="#A80036" points="745,989.1719,735,993.1719,745,997.1719,741,993.1719" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="739" x2="1147" y1="993.1719" y2="993.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="314" x="751" y="972.9731">DIDComm Forward (RFC0351-PurposeDecorator)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="751" y="988.106">Success message</text><polygon fill="#A80036" points="366,1033.4375,356,1037.4375,366,1041.4375,362,1037.4375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="360" x2="733" y1="1037.4375" y2="1037.4375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="372" y="1017.2388">DIDComm (RFC0351-PurposeDecorator)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="372" y="1032.3716">Success message</text><polygon fill="#A80036" points="1136,1062.5703,1146,1066.5703,1136,1070.5703,1140,1066.5703" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="355" x2="1142" y1="1066.5703" y2="1066.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="362" y="1061.5044">CHAPI response</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="212" x="504.5" y="1105.7808">when rp wants credential from wallet</text><path d="M10,1129.375 L449,1129.375 L449,1136.375 L439,1146.375 L10,1146.375 L10,1129.375 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="962.7813" style="stroke: #000000; stroke-width: 2.0;" width="1394" x="10" y="1129.375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="394" x="25" y="1142.4419">RP-Wallet Connect and Wallet-Issuer AuthZ request</text><polygon fill="#A80036" points="343,1178.7734,353,1182.7734,343,1186.7734,347,1182.7734" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="69" x2="349" y1="1182.7734" y2="1182.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="76" y="1162.5747">CHAPI Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="257" x="76" y="1177.7075">(DIDComm invitation + Governance VC)</text><polygon fill="#A80036" points="80,1207.9063,70,1211.9063,80,1215.9063,76,1211.9063" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="74" x2="354" y1="1211.9063" y2="1211.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="86" y="1206.8403">DIDComm (DID Exchange)</text><polygon fill="#A80036" points="722,1237.0391,732,1241.0391,722,1245.0391,726,1241.0391" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="69" x2="728" y1="1241.0391" y2="1241.0391"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="222" x="76" y="1235.9731">DIDComm Forward(DID Exchange)</text><polygon fill="#A80036" points="366,1266.1719,356,1270.1719,366,1274.1719,362,1270.1719" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="360" x2="733" y1="1270.1719" y2="1270.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="372" y="1265.106">DIDComm (DID Exchange)</text><polygon fill="#A80036" points="80,1310.4375,70,1314.4375,80,1318.4375,76,1314.4375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="74" x2="354" y1="1314.4375" y2="1314.4375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="86" y="1294.2388">DIDComm (RFC0351-PurposeDecorator)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="86" y="1309.3716">Request PeerDID for router</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="69" x2="111" y1="1343.5703" y2="1343.5703"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="111" x2="111" y1="1343.5703" y2="1356.5703"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="70" x2="111" y1="1356.5703" y2="1356.5703"/><polygon fill="#A80036" points="80,1352.5703,70,1356.5703,80,1360.5703,76,1356.5703" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="76" y="1338.5044">create new PeerDID</text><polygon fill="#A80036" points="722,1396.8359,732,1400.8359,722,1404.8359,726,1400.8359" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="69" x2="728" y1="1400.8359" y2="1400.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="310" x="76" y="1380.6372">DIDComm Forward(RFC0351-PurposeDecorator)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="138" x="76" y="1395.77">RP PeerDID for router</text><polygon fill="#A80036" points="366,1441.1016,356,1445.1016,366,1449.1016,362,1445.1016" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="360" x2="733" y1="1445.1016" y2="1445.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="372" y="1424.9028">DIDComm (RFC0351-PurposeDecorator)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="138" x="372" y="1440.0356">RP PeerDID for router</text><polygon fill="#A80036" points="722,1485.3672,732,1489.3672,722,1493.3672,726,1489.3672" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="355" x2="728" y1="1489.3672" y2="1489.3672"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="362" y="1469.1685">DIDComm (RFC0351-PurposeDecorator)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="313" x="362" y="1484.3013">Request PeerDID for RP (pass RP peerDID in req)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="734" x2="776" y1="1518.5" y2="1518.5"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="776" x2="776" y1="1518.5" y2="1531.5"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="735" x2="776" y1="1531.5" y2="1531.5"/><polygon fill="#A80036" points="745,1527.5,735,1531.5,745,1535.5,741,1531.5" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="379" x="741" y="1513.4341">create new PeerDID and manual connection record with RP</text><polygon fill="#A80036" points="366,1571.7656,356,1575.7656,366,1579.7656,362,1575.7656" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="360" x2="733" y1="1575.7656" y2="1575.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="372" y="1555.5669">DIDComm (RFC0351-PurposeDecorator)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="372" y="1570.6997">Router PeerDID for RP</text><polygon fill="#A80036" points="80,1616.0313,70,1620.0313,80,1624.0313,76,1620.0313" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="74" x2="354" y1="1620.0313" y2="1620.0313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="86" y="1599.8325">DIDComm (RFC0351-PurposeDecorator)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="86" y="1614.9653">Send Router PeerDID</text><polygon fill="#A80036" points="722,1645.1641,732,1649.1641,722,1653.1641,726,1649.1641" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="69" x2="728" y1="1649.1641" y2="1649.1641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="76" y="1644.0981">DIDComm (register route)</text><polygon fill="#A80036" points="80,1674.2969,70,1678.2969,80,1682.2969,76,1678.2969" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="74" x2="733" y1="1678.2969" y2="1678.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="86" y="1673.231">DIDComm (register success)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="69" x2="111" y1="1707.4297" y2="1707.4297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="111" x2="111" y1="1707.4297" y2="1720.4297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="70" x2="111" y1="1720.4297" y2="1720.4297"/><polygon fill="#A80036" points="80,1716.4297,70,1720.4297,80,1724.4297,76,1720.4297" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="237" x="76" y="1702.3638">Create Peer DID with router endpoint</text><polygon fill="#A80036" points="722,1745.5625,732,1749.5625,722,1753.5625,726,1749.5625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="69" x2="728" y1="1749.5625" y2="1749.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="237" x="76" y="1744.4966">DIDComm (register peerDID pubKey)</text><polygon fill="#A80036" points="80,1774.6953,70,1778.6953,80,1782.6953,76,1778.6953" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="74" x2="733" y1="1778.6953" y2="1778.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="211" x="86" y="1773.6294">DIDComm (register key success)</text><polygon fill="#A80036" points="722,1818.9609,732,1822.9609,722,1826.9609,726,1822.9609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="69" x2="728" y1="1822.9609" y2="1822.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="310" x="76" y="1802.7622">DIDComm Forward(RFC0351-PurposeDecorator)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="76" y="1817.895">Pass RP peerDID for AuthZ req</text><polygon fill="#A80036" points="366,1863.2266,356,1867.2266,366,1871.2266,362,1867.2266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="360" x2="733" y1="1867.2266" y2="1867.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="310" x="372" y="1847.0278">DIDComm Forward(RFC0351-PurposeDecorator)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="372" y="1862.1606">Pass RP peerDID for AuthZ req</text><polygon fill="#A80036" points="1136,1892.3594,1146,1896.3594,1136,1900.3594,1140,1896.3594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="355" x2="1142" y1="1896.3594" y2="1896.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="362" y="1891.2935">DIDComm (authz request)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1148" x2="1190" y1="1925.4922" y2="1925.4922"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1190" x2="1190" y1="1925.4922" y2="1938.4922"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1149" x2="1190" y1="1938.4922" y2="1938.4922"/><polygon fill="#A80036" points="1159,1934.4922,1149,1938.4922,1159,1942.4922,1155,1938.4922" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="237" x="1155" y="1920.4263">Create Peer DID with router endpoint</text><polygon fill="#A80036" points="745,1963.625,735,1967.625,745,1971.625,741,1967.625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="739" x2="1147" y1="1967.625" y2="1967.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="237" x="751" y="1962.5591">DIDComm (register peerDID pubKey)</text><polygon fill="#A80036" points="1136,1992.7578,1146,1996.7578,1136,2000.7578,1140,1996.7578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="734" x2="1142" y1="1996.7578" y2="1996.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="211" x="741" y="1991.6919">DIDComm (register key success)</text><polygon fill="#A80036" points="745,2021.8906,735,2025.8906,745,2029.8906,741,2025.8906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="739" x2="1147" y1="2025.8906" y2="2025.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="231" x="751" y="2020.8247">DIDComm Forward(authz response)</text><polygon fill="#A80036" points="366,2051.0234,356,2055.0234,366,2059.0234,362,2055.0234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="360" x2="733" y1="2055.0234" y2="2055.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="372" y="2049.9575">DIDComm (authz response)</text><polygon fill="#A80036" points="80,2080.1563,70,2084.1563,80,2088.1563,76,2084.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="74" x2="354" y1="2084.1563" y2="2084.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="86" y="2079.0903">CHAPI response</text><path d="M10,2106.1563 L369,2106.1563 L369,2113.1563 L359,2123.1563 L10,2123.1563 L10,2106.1563 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="133.6641" style="stroke: #000000; stroke-width: 2.0;" width="1209.5" x="10" y="2106.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="314" x="25" y="2119.2231">RP asks for actual credential from issuer</text><polygon fill="#A80036" points="722,2140.4219,732,2144.4219,722,2148.4219,726,2144.4219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="69" x2="728" y1="2144.4219" y2="2144.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223" x="76" y="2139.356">DIDComm Forward (Actual VC req)</text><polygon fill="#A80036" points="1136,2169.5547,1146,2173.5547,1136,2177.5547,1140,2173.5547" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="734" x2="1142" y1="2173.5547" y2="2173.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="741" y="2168.4888">DIDComm (Actual VC req)</text><polygon fill="#A80036" points="745,2198.6875,735,2202.6875,745,2206.6875,741,2202.6875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="739" x2="1147" y1="2202.6875" y2="2202.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="186" x="751" y="2197.6216">DIDComm Forward (VC resp)</text><polygon fill="#A80036" points="80,2227.8203,70,2231.8203,80,2235.8203,76,2231.8203" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="74" x2="733" y1="2231.8203" y2="2231.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="86" y="2226.7544">DIDComm (VC resp)</text><!--MD5=[c5990a8667f2742cf9deff23fa03c726]
@startuml
title Blinded routing through User selected route

participant rp_adapter as ra
actor wallet
participant router
participant issuer_adapter as ia

group Wallet onboarding
wallet -> router : HTTP POST Generate DIDComm invitation
router -> wallet : HTTP 200 Invitation
wallet <-> router : DIDComm (DIDExchange)
wallet -> router : DIDComm (register route)
router -> wallet : DIDComm (register success)
end

... when user wants to connect issuer to wallet ...
group Issuer-Wallet Connect
ia -> wallet : CHAPI Request\n(DIDComm invitation + Governance VC)
wallet -> ia : DIDComm (DID Exchange)
ia -> router : DIDComm Forward (DID Exchange)
router -> wallet : DIDComm (DID Exchange)

wallet -> ia : DIDComm (TBD Protocol) \nRequest PeerDID for router
ia -> ia : create new PeerDID
ia -> router : DIDComm Forward (RFC0351-PurposeDecorator) \nIssuer PeerDID for router
router -> wallet : DIDComm (RFC0351-PurposeDecorator) \nIssuer PeerDID for router
wallet -> router : DIDComm (RFC0351-PurposeDecorator) \nRequest PeerDID for issuer (pass issuer peerDID in req)
router -> router : create new PeerDID and manual connection record with issuer
router -> wallet : DIDComm (RFC0351-PurposeDecorator) \nRouter PeerDID for issuer
wallet -> ia : DIDComm (RFC0351-PurposeDecorator) \nSend Router PeerDID
ia -> ia : create manual connection record with router
ia -> router : DIDComm (register route)
router -> ia : DIDComm (register success)
ia -> router : DIDComm Forward (RFC0351-PurposeDecorator) \nSuccess message
router -> wallet : DIDComm (RFC0351-PurposeDecorator) \nSuccess message
wallet -> ia : CHAPI response
end

... when rp wants credential from wallet...
group RP-Wallet Connect and Wallet-Issuer AuthZ request
ra -> wallet : CHAPI Request\n(DIDComm invitation + Governance VC)
wallet -> ra : DIDComm (DID Exchange)
ra -> router : DIDComm Forward(DID Exchange)
router -> wallet : DIDComm (DID Exchange)

wallet -> ra : DIDComm (RFC0351-PurposeDecorator) \nRequest PeerDID for router
ra -> ra : create new PeerDID
ra -> router : DIDComm Forward(RFC0351-PurposeDecorator) \nRP PeerDID for router
router -> wallet : DIDComm (RFC0351-PurposeDecorator) \nRP PeerDID for router
wallet -> router : DIDComm (RFC0351-PurposeDecorator) \nRequest PeerDID for RP (pass RP peerDID in req)
router -> router : create new PeerDID and manual connection record with RP
router -> wallet : DIDComm (RFC0351-PurposeDecorator) \nRouter PeerDID for RP
wallet -> ra : DIDComm (RFC0351-PurposeDecorator) \nSend Router PeerDID
ra -> router : DIDComm (register route)
router -> ra : DIDComm (register success)
ra -> ra : Create Peer DID with router endpoint
ra -> router : DIDComm (register peerDID pubKey)
router -> ra : DIDComm (register key success)
ra -> router : DIDComm Forward(RFC0351-PurposeDecorator) \nPass RP peerDID for AuthZ req
router -> wallet : DIDComm Forward(RFC0351-PurposeDecorator) \nPass RP peerDID for AuthZ req
wallet -> ia : DIDComm (authz request)
ia -> ia : Create Peer DID with router endpoint
ia -> router : DIDComm (register peerDID pubKey)
router -> ia : DIDComm (register key success)
ia -> router : DIDComm Forward(authz response)
router -> wallet : DIDComm (authz response)
wallet -> ra : CHAPI response
end

group RP asks for actual credential from issuer
ra -> router : DIDComm Forward (Actual VC req)
router -> ia : DIDComm (Actual VC req)
ia -> router : DIDComm Forward (VC resp)
router -> ra : DIDComm (VC resp)
end
@enduml

PlantUML version 1.2020.20beta4(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>